{% extends "base.html" %}

{% block title %}Content Generator | Ardelis Technologies{% endblock %}

{% block head %}
    <style>
        /* Modern Professional Design System */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --sidebar-width: 280px;
            --header-height: 80px;
            --border-radius-modern: 16px;
            --shadow-modern: 0 10px 30px rgba(0,0,0,0.1);
            --shadow-hover: 0 20px 40px rgba(0,0,0,0.15);

            /* Light Theme Variables */
            --card-bg: #ffffff;
            --darker-color: #f8f9fa;
            --card-border: #e9ecef;
            --text-primary: #212529;
            --text-muted: #6c757d;
            --primary-color: #667eea;
        }

        /* Modern Header */
        .modern-header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--card-border);
            padding: 1.5rem 2rem;
            margin: -2rem -2rem 2rem -2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 100%;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .header-icon {
            width: 60px;
            height: 60px;
            background: var(--primary-gradient);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow-modern);
        }

        .header-text h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-subtitle {
            color: var(--text-muted);
            font-size: 1rem;
            margin: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .action-stats {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1rem;
            background: var(--darker-color);
            border-radius: 12px;
            border: 1px solid var(--card-border);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn-generate {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary-light {
            background: var(--darker-color);
            color: var(--text-primary);
            border: 1px solid var(--card-border);
            padding: 0.75rem;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .btn-secondary-light:hover {
            background: var(--card-border);
            transform: translateY(-1px);
        }

        /* Modern Layout */
        .modern-layout {
            display: flex;
            min-height: calc(100vh - var(--header-height));
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--card-bg);
            border-right: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: calc(100vh - var(--header-height));
            top: var(--header-height);
            left: 0;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid var(--card-border);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow-modern);
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1.5rem 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 1.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-items {
            display: flex;
            flex-direction: column;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-item:hover {
            color: var(--text-primary);
            background: var(--darker-color);
        }

        .nav-item.active {
            color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary-gradient);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--card-border);
        }

        .btn-generate-large {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: var(--border-radius-modern);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-modern);
        }

        .btn-generate-large:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 2rem;
            display: flex;
            flex-direction: column;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 3rem;
            padding: 1.5rem;
            background: var(--darker-color);
            border-radius: var(--border-radius-modern);
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: var(--primary-gradient);
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .step-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .step.active .step-label {
            color: var(--text-primary);
        }

        .step-connector {
            width: 60px;
            height: 2px;
            background: var(--card-border);
        }

        /* Content Sections */
        .content-sections {
            flex: 1;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-title i {
            color: var(--primary-color);
        }

        .section-subtitle {
            color: var(--text-muted);
            font-size: 1rem;
            margin: 0;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .setting-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--border-radius-modern);
            padding: 2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .setting-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        /* Form Elements Modern Styling */
        .form-group-modern {
            margin-bottom: 1.5rem;
        }

        .form-label-modern {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .form-label-modern i {
            color: var(--primary-color);
            font-size: 0.875rem;
        }

        .form-control-modern,
        .form-select-modern {
            background: var(--darker-color);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .form-control-modern:focus,
        .form-select-modern:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: var(--card-bg);
        }

        .form-control-modern::placeholder {
            color: var(--text-muted);
        }

        /* Platform Selection Modern */
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .platform-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: var(--darker-color);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .platform-item:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }

        .platform-item.selected {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .platform-item input[type="checkbox"] {
            margin-right: 0.75rem;
        }

        .platform-item label {
            cursor: pointer;
            color: var(--text-primary);
            font-weight: 500;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Style Options Modern */
        .style-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .style-option-card {
            padding: 1rem;
            background: var(--darker-color);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .style-option-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .style-option-card.selected {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .style-option-card input[type="radio"] {
            margin-right: 0.75rem;
        }

        .style-option-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .style-option-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin: 0;
        }

        /* Number Input Modern */
        .number-input-modern {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .number-input-modern input[type="number"] {
            background: var(--darker-color);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            width: 120px;
            text-align: center;
        }

        /* Voice Input Modern */
        .voice-input-card {
            background: var(--darker-color);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .voice-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-gradient);
            border: none;
            color: white;
            font-size: 1.5rem;
            margin: 0 auto 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .voice-button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .voice-button.recording {
            background: var(--warning-gradient);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(240, 147, 251, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(240, 147, 251, 0); }
            100% { box-shadow: 0 0 0 0 rgba(240, 147, 251, 0); }
        }

        .voice-transcript {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-primary);
            min-height: 80px;
            resize: vertical;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .modern-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                top: 0;
            }

            .main-content {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .main-content {
                padding: 1rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .progress-steps {
                flex-direction: column;
                gap: 1rem;
            }

            .step-connector {
                width: 2px;
                height: 30px;
            }
        }

        /* Dark mode for accordions */
        .accordion-item {
            background: var(--card-bg) !important;
            border: 1px solid var(--card-border) !important;
        }

        .accordion-button {
            background: var(--card-bg) !important;
            color: var(--text-primary) !important;
            border: none !important;
        }

        .accordion-button:not(.collapsed) {
            background: var(--darker-color) !important;
            color: var(--text-primary) !important;
            box-shadow: none !important;
        }

        .accordion-button:focus {
            box-shadow: none !important;
            border-color: var(--card-border) !important;
        }

        .accordion-button::after {
            filter: invert(1);
        }

        .accordion-body {
            background: var(--card-bg) !important;
            color: var(--text-primary) !important;
            border-top: 1px solid var(--card-border) !important;
        }

        /* Dark mode for custom formats section */
        .border.rounded.p-3.bg-light {
            background: var(--darker-color) !important;
            border: 1px solid var(--card-border) !important;
            color: var(--text-primary) !important;
        }

        .text-muted {
            color: var(--text-muted) !important;
        }

        /* Dark mode for form elements in accordions */
        .accordion .form-control,
        .accordion .form-select {
            background: var(--darker-color) !important;
            border: 1px solid var(--card-border) !important;
            color: var(--text-primary) !important;
        }

        .accordion .form-control:focus,
        .accordion .form-select:focus {
            background: var(--darker-color) !important;
            border-color: var(--primary-color) !important;
            color: var(--text-primary) !important;
            box-shadow: 0 0 0 0.2rem rgba(249, 115, 22, 0.25) !important;
        }

        .accordion .form-control::placeholder {
            color: var(--text-muted) !important;
        }

        /* Dark mode for buttons in accordions */
        .accordion .btn-outline-primary {
            border-color: var(--primary-color) !important;
            color: var(--primary-color) !important;
        }

        .accordion .btn-outline-primary:hover {
            background: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
            color: white !important;
        }

        .accordion .btn-outline-info {
            border-color: #17a2b8 !important;
            color: #17a2b8 !important;
        }

        .accordion .btn-outline-info:hover {
            background: #17a2b8 !important;
            border-color: #17a2b8 !important;
            color: white !important;
        }

        .accordion .btn-outline-success {
            border-color: #28a745 !important;
            color: #28a745 !important;
        }

        .accordion .btn-outline-success:hover {
            background: #28a745 !important;
            border-color: #28a745 !important;
            color: white !important;
        }

        /* Dark mode for Add Topic Modal */
        .modal-content {
            background: var(--card-bg) !important;
            border: 1px solid var(--card-border) !important;
        }

        .modal-header.bg-primary {
            background: var(--primary-color) !important;
            border-bottom: 1px solid var(--card-border) !important;
        }

        .modal-header .modal-title {
            color: white !important;
        }

        .modal-body {
            background: var(--card-bg) !important;
            color: var(--text-primary) !important;
        }

        .modal .form-label {
            color: var(--text-primary) !important;
        }

        .modal .form-control, .modal .form-select {
            background: var(--darker-color) !important;
            border: 1px solid var(--card-border) !important;
            color: var(--text-primary) !important;
        }

        .modal .form-control:focus, .modal .form-select:focus {
            background: var(--darker-color) !important;
            border-color: var(--primary-color) !important;
            color: var(--text-primary) !important;
            box-shadow: 0 0 0 0.2rem rgba(249, 115, 22, 0.25) !important;
        }

        .modal .form-control::placeholder {
            color: var(--text-muted) !important;
        }

        .modal .form-text {
            color: var(--text-muted) !important;
        }

        .modal .form-check {
            color: var(--text-primary) !important;
        }

        .modal .form-check-input {
            background-color: var(--darker-color) !important;
            border-color: var(--card-border) !important;
        }

        .modal .form-check-input:checked {
            background-color: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
        }

        .modal .btn-close {
            filter: invert(1);
        }

        .modal .btn-close-white {
            filter: invert(1);
        }

        /* Dark mode for key points in modal */
        .bg-light {
            background: var(--darker-color) !important;
            color: var(--text-primary) !important;
        }

        .generation-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .generated-content {
            background: var(--darker-color) !important;
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin: 1rem 0;
            color: var(--text-primary) !important;
            border-radius: 0.5rem;
        }

        .generated-content p {
            color: var(--text-primary) !important;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .generated-content strong {
            color: #ffffff !important;
            font-weight: 600;
        }

        .generated-content em {
            color: var(--text-secondary) !important;
            font-style: italic;
        }

        /* Style options with dark theme */
        .style-option {
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--card-bg) !important;
            border: 1px solid var(--card-border) !important;
            color: var(--text-primary) !important;
        }

        .style-option:hover {
            background: rgba(249, 115, 22, 0.1) !important;
            border-color: var(--primary-color) !important;
            transform: translateY(-1px);
        }

        .style-option.active {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.15), rgba(249, 115, 22, 0.05)) !important;
            border-color: var(--primary-color) !important;
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.2);
        }

        /* Voice recording area dark theme */
        .border.rounded.p-3.bg-light {
            background: var(--darker-color) !important;
            border: 1px solid var(--card-border) !important;
            color: var(--text-primary);
        }

        /* Form elements dark theme */
        .form-control, .form-select {
            background: var(--card-bg) !important;
            border: 1px solid var(--card-border) !important;
            color: var(--text-primary) !important;
        }

        .form-control:focus, .form-select:focus {
            background: var(--card-bg) !important;
            border-color: var(--primary-color) !important;
            color: var(--text-primary) !important;
            box-shadow: 0 0 0 0.2rem rgba(249, 115, 22, 0.25);
        }

        .form-control::placeholder {
            color: var(--text-muted) !important;
        }

        /* Card headers dark theme */
        .card-header.bg-white {
            background: var(--card-bg) !important;
            border-bottom: 1px solid var(--card-border) !important;
        }

        .card-header h5 {
            color: var(--text-primary) !important;
        }

        /* Button styling for dark theme */
        .btn-outline-primary {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline-primary:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .btn-outline-secondary {
            border-color: var(--text-muted);
            color: var(--text-muted);
        }

        .btn-outline-secondary:hover {
            background: var(--text-muted);
            border-color: var(--text-muted);
            color: white;
        }

        /* Loading and empty states */
        .display-1.text-muted {
            color: var(--text-muted) !important;
        }

        .text-muted {
            color: var(--text-muted) !important;
        }

        /* Icons in style options */
        .style-option i {
            color: var(--primary-color) !important;
        }

        .style-option.active i {
            color: white !important;
            text-shadow: 0 0 10px rgba(249, 115, 22, 0.5);
        }

        /* Voice recording specific styling */
        .badge.bg-danger {
            background: var(--danger-color) !important;
        }

        /* Enhanced dark theme for generated content area */
        #generatedContent {
            background: var(--card-bg) !important;
            border-radius: 0.5rem;
        }

        /* Copy buttons in generated content */
        .copy-btn {
            background: rgba(249, 115, 22, 0.1) !important;
            border: 1px solid var(--primary-color) !important;
            color: var(--primary-color) !important;
        }

        .copy-btn:hover {
            background: var(--primary-color) !important;
            color: white !important;
        }

        /* Enhanced Header Layout */
        .top-header {
            padding: 1.5rem 0 !important;
            border-bottom: 1px solid var(--card-border) !important;
            background: var(--card-bg) !important;
        }

        .top-header .row {
            align-items: center !important;
            min-height: 80px;
        }

        /* Responsive button sizing */
        .btn-sm-md {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .btn-sm-md {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
        }

        /* Button hover effects */
        .top-header .btn {
            transition: all 0.3s ease;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .top-header .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* Responsive Styles for Content Settings */
        @media (max-width: 768px) {
            /* Generator Form Card */
            .card.border-0.shadow-sm {
                border-radius: 12px !important;
                margin-bottom: 1rem;
            }

            /* Generation Method Cards */
            .row.g-3 > .col-md-6 {
                margin-bottom: 1rem;
            }

            .card.border-2 {
                border: 2px solid var(--card-border) !important;
                border-radius: 12px !important;
                transition: all 0.3s ease;
            }

            .card.border-2:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            }

            /* Method Cards Specific */
            .method-card {
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .method-card:hover {
                border-color: var(--primary-color) !important;
            }

            .form-check-input:checked + .form-check-label {
                color: var(--primary-color) !important;
            }

            .method-card .form-check-input:checked {
                background-color: var(--primary-color) !important;
                border-color: var(--primary-color) !important;
            }

            /* Button Groups Mobile */
            .d-grid.gap-2.d-md-flex {
                gap: 0.5rem !important;
            }

            .btn.flex-fill {
                min-width: 0 !important;
                flex: 1 !important;
            }

            /* Accordion Responsive */
            .accordion-button {
                padding: 1rem !important;
                font-size: 0.95rem !important;
            }

            .accordion-button:not(.collapsed) {
                background: var(--darker-color) !important;
                color: var(--text-primary) !important;
            }

            .accordion-body {
                padding: 1rem !important;
            }

            /* Form Controls Mobile */
            .form-control, .form-select {
                font-size: 0.95rem !important;
                padding: 0.75rem !important;
                border-radius: 8px !important;
            }

            .form-control::placeholder {
                font-size: 0.9rem !important;
            }

            /* Textareas Mobile */
            textarea.form-control {
                min-height: 100px !important;
                resize: vertical;
            }

            #customInstructions {
                min-height: 150px !important;
            }

            #exampleContent {
                min-height: 120px !important;
            }

            /* Buttons Mobile */
            .btn {
                font-size: 0.9rem !important;
                padding: 0.6rem 1rem !important;
                border-radius: 8px !important;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .btn-sm {
                font-size: 0.8rem !important;
                padding: 0.5rem 0.8rem !important;
            }

            /* Generation Method Cards Mobile */
            .display-4 {
                font-size: 2.5rem !important;
                margin-bottom: 1rem !important;
            }

            .card-body {
                padding: 1.25rem !important;
            }

            /* Examples Section Mobile */
            .border.rounded.p-3.mb-3.bg-light {
                padding: 1rem !important;
                border-radius: 12px !important;
            }

            .content-preview.small {
                font-size: 0.85rem !important;
                line-height: 1.4 !important;
            }

            /* Advanced Settings Mobile */
            .row.g-3 > .col-md-4 {
                margin-bottom: 1rem;
            }

            /* Form Check Mobile */
            .form-check {
                margin-bottom: 0.5rem;
            }

            .form-check-input {
                margin-right: 0.5rem;
            }

            /* Cards in Examples */
            .card.border-secondary {
                border-radius: 12px !important;
                margin-bottom: 0.75rem;
            }

            .card-body {
                padding: 1rem !important;
            }

            /* Template Selection Mobile */
            .form-select.form-select-sm.d-inline-block.w-auto {
                width: 100% !important;
                margin-top: 0.5rem !important;
                display: block !important;
            }

            /* Example Input Fields Mobile */
            #exampleTopic, #exampleHashtags {
                font-size: 0.9rem !important;
            }

            /* Info Messages Mobile */
            .text-info {
                font-size: 0.85rem !important;
                line-height: 1.4 !important;
            }

            /* Small text adjustments */
            .small.text-muted {
                font-size: 0.8rem !important;
                line-height: 1.3 !important;
            }
        }

        @media (max-width: 576px) {
            /* Extra Small Screens */
            .container-fluid.p-4 {
                padding: 1rem !important;
            }

            .card-body {
                padding: 1rem !important;
            }

            .accordion-button {
                padding: 0.75rem 1rem !important;
                font-size: 0.9rem !important;
            }

            .accordion-body {
                padding: 0.75rem 1rem !important;
            }

            /* Form controls for very small screens */
            .form-control, .form-select {
                font-size: 0.9rem !important;
                padding: 0.6rem !important;
            }

            /* Buttons for very small screens */
            .btn {
                font-size: 0.85rem !important;
                padding: 0.5rem 0.8rem !important;
                margin-bottom: 0.5rem !important;
                width: 100% !important;
            }

            .btn-group .btn {
                width: auto !important;
                margin-bottom: 0 !important;
            }

            /* Examples cards for very small screens */
            .card.border-secondary {
                margin-bottom: 0.5rem;
            }

            /* Remove unnecessary spacing */
            .mb-4 {
                margin-bottom: 1rem !important;
            }

            .mb-3 {
                margin-bottom: 0.75rem !important;
            }

            /* Method Cards for very small screens */
            .method-card .card-body {
                padding: 0.75rem !important;
            }

            .method-card .display-4 {
                font-size: 1.75rem !important;
                margin-bottom: 0.5rem !important;
            }

            .method-card h6 {
                font-size: 0.9rem !important;
            }

            .method-card .small.text-muted {
                font-size: 0.75rem !important;
                line-height: 1.3 !important;
            }

            /* Template dropdown for mobile */
            #instructionTemplate {
                margin-top: 0.5rem !important;
                font-size: 0.85rem !important;
            }

            /* Button text for very small screens */
            .btn i {
                margin-right: 0.25rem !important;
            }
        }

        /* Header spacing improvements */
        .top-header h1 {
            font-weight: 600;
            margin-bottom: 0.25rem !important;
        }

        .top-header p {
            margin-bottom: 0 !important;
            font-size: 0.9rem;
        }
    </style>
{% endblock %}

{% block content %}
    <!-- Simple Clean Header -->
    <div class="simple-header">
        <div class="header-top">
            <div class="header-title">
                <h1>âœ¨ Content Generator</h1>
                <p>Create engaging social media content in seconds</p>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Two-Column Layout for Desktop -->
    <div class="content-wrapper">
        <div class="main-layout">
            <!-- Left Column: Settings -->
            <div class="settings-column">
                    <!-- Basic Settings Section -->
                    <div class="settings-section">
  
                        <div class="settings-grid">
                            <div class="setting-card">
                                <form id="generatorForm">
                            <!-- Topic Input -->
                            <div class="form-group-modern">
                                <label class="form-label-modern">
                                    <i class="fas fa-pencil-alt"></i>
                                    Topic
                                </label>
                                <input type="text" class="form-control-modern" id="topicInput" placeholder="Enter your content topic...">
                            </div>

                            <!-- Style Selection -->
                            <div class="form-group-modern">
                                <label class="form-label-modern">
                                    <i class="fas fa-palette"></i>
                                    Style
                                </label>
                                <div class="style-options-grid">
                                    <div class="style-option-card">
                                        <div class="d-flex align-items-center">
                                            <input type="radio" name="style" value="educational" id="styleEducational" checked>
                                            <label for="styleEducational" class="w-100">
                                                <div class="style-option-title">Educational</div>
                                                <div class="style-option-desc">Informative and helpful content</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="style-option-card">
                                        <div class="d-flex align-items-center">
                                            <input type="radio" name="style" value="promotional" id="stylePromotional">
                                            <label for="stylePromotional" class="w-100">
                                                <div class="style-option-title">Promotional</div>
                                                <div class="style-option-desc">Marketing and sales focused</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="style-option-card">
                                        <div class="d-flex align-items-center">
                                            <input type="radio" name="style" value="industry_insights" id="styleIndustry">
                                            <label for="styleIndustry" class="w-100">
                                                <div class="style-option-title">Industry Insights</div>
                                                <div class="style-option-desc">Trends and analysis</div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Platform Selection -->
                            <div class="form-group-modern">
                                <label class="form-label-modern">
                                    <i class="fas fa-share-alt"></i>
                                    Platforms
                                </label>
                                <div class="platform-grid">
                                    <div class="platform-item">
                                        <input type="checkbox" value="linkedin" id="linkedinCheck" checked>
                                        <label for="linkedinCheck">
                                            <i class="fab fa-linkedin"></i> LinkedIn
                                        </label>
                                    </div>
                                    <div class="platform-item">
                                        <input type="checkbox" value="twitter" id="twitterCheck">
                                        <label for="twitterCheck">
                                            <i class="fab fa-x-twitter"></i> X
                                        </label>
                                    </div>
                                    <div class="platform-item">
                                        <input type="checkbox" value="instagram" id="instagramCheck">
                                        <label for="instagramCheck">
                                            <i class="fab fa-instagram"></i> Instagram
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Number of Posts -->
                            <div class="form-group-modern">
                                <label class="form-label-modern">
                                    <i class="fas fa-copy"></i>
                                    Number of Posts
                                </label>
                                <select class="form-select-modern" id="numPostsSelect">
                                    <option value="1">1 Post</option>
                                    <option value="3">3 Posts</option>
                                    <option value="5">5 Posts</option>
                                    <option value="10">10 Posts</option>
                                </select>
                            </div>

                            <!-- Voice Input -->
                            <div class="form-group-modern">
                                <label class="form-label-modern">
                                    <i class="fas fa-microphone"></i>
                                    Voice Input (Optional)
                                </label>
                                <div class="voice-input-card">
                                    <div class="voice-button" id="recordBtn" onclick="toggleRecording()">
                                        <i class="fas fa-microphone"></i>
                                    </div>
                                    <p class="text-muted mb-3">Click to record your content idea</p>
                                    <textarea class="voice-transcript" id="voiceTranscript" placeholder="Voice transcript will appear here..." readonly></textarea>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Advanced Settings Card -->
                    <div class="setting-card">
                        <h3>ðŸ§  Advanced Generation Settings</h3>

                        <!-- Generation Method Selection -->
                        <div class="form-group-modern">
                            <label class="form-label-modern">
                                <i class="fas fa-brain"></i>
                                Generation Method
                            </label>
                            <div class="method-selection">
                                <div class="method-option active" onclick="selectMethod('instructions', this)">
                                    <i class="fas fa-keyboard"></i>
                                    <div>
                                        <strong>Custom Instructions</strong>
                                        <p>Provide specific instructions for content</p>
                                    </div>
                                </div>
                                <div class="method-option" onclick="selectMethod('examples', this)">
                                    <i class="fas fa-copy"></i>
                                    <div>
                                        <strong>Learn from Examples</strong>
                                        <p>AI learns from your existing posts</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Instructions Section -->
                        <div id="instructionsSection" class="method-section">
                            <div class="form-group-modern">
                                <label class="form-label-modern">
                                    <i class="fas fa-edit"></i>
                                    Custom Instructions
                                </label>
                                <textarea class="form-control-modern" id="customInstructions" rows="4"
                                          placeholder="Example: Write in a professional tone with actionable tips..."></textarea>
                                <div class="quick-templates">
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleInstructionTemplates()">
                                        <i class="fas fa-lightbulb"></i> Use Template
                                    </button>
                                    <select class="form-select form-select-sm" id="instructionTemplate" onchange="applyInstructionTemplate()" style="display: none;">
                                        <option value="">Choose a template...</option>
                                        <option value="professional">Professional & Authoritative</option>
                                        <option value="casual">Casual & Friendly</option>
                                        <option value="educational">Educational & Informative</option>
                                        <option value="storytelling">Storytelling & Engaging</option>
                                        <option value="data_driven">Data-Driven & Analytical</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Examples Section -->
                        <div id="examplesSection" class="method-section" style="display: none;">
                            <div class="form-group-modern">
                                <label class="form-label-modern">
                                    <i class="fas fa-file-alt"></i>
                                    Example Posts
                                </label>
                                <div class="example-input">
                                    <input type="text" class="form-control-modern" id="exampleTopic" placeholder="Example topic...">
                                    <textarea class="form-control-modern" id="exampleContent" rows="3" placeholder="Paste example post content..."></textarea>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="addExample()">
                                        <i class="fas fa-plus"></i> Add Example
                                    </button>
                                </div>
                                <div id="examplesList" class="examples-list"></div>
                            </div>
                        </div>

                        <!-- Additional Settings -->
                        <div class="form-group-modern">
                            <label class="form-label-modern">
                                <i class="fas fa-sliders-h"></i>
                                Additional Settings
                            </label>
                            <div class="settings-row">
                                <select class="form-select-modern" id="creativityLevel">
                                    <option value="balanced">Balanced (Recommended)</option>
                                    <option value="conservative">Conservative</option>
                                    <option value="creative">Creative</option>
                                </select>
                                <select class="form-select-modern" id="contentLength">
                                    <option value="medium">Medium Length</option>
                                    <option value="short">Short</option>
                                    <option value="long">Long</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <div class="generate-section">
                    <button class="generate-btn" onclick="startGeneration()">
                        <i class="fas fa-magic"></i>
                        Generate Content
                    </button>
                </div>
            </div>

            <!-- Generate Content Button Before Generated Content -->
            <div class="text-center mb-4">
                <button class="btn btn-success btn-lg generate-btn-main" onclick="startGeneration()">
                    <i class="fas fa-magic me-2"></i>Generate Content
                </button>
            </div>

            <!-- Right Column: Generated Content Sidebar -->
            <div class="generated-content-sidebar" id="generatedContentSidebar">
                <div class="sidebar-header">
                    <h3>ðŸ“„ Generated Content</h3>
                    <div class="content-stats">
                        <span id="contentCount">0</span> posts
                    </div>
                </div>

                <div class="generated-content" id="generatedContent">
                    <div class="empty-state">
                        <i class="fas fa-sparkles"></i>
                        <h3>Ready to Generate</h3>
                        <p>Configure settings and click Generate</p>
                    </div>
                </div>

                <!-- Floating Action Button for Mobile -->
                <button class="floating-generate-btn" onclick="startGeneration()" id="floatingGenerateBtn">
                    <i class="fas fa-magic"></i>
                </button>
            </div>
        </div>
    </div>
                                        <i class="fas fa-pencil-alt me-1"></i> Single
                                    </label>

                                    <input type="radio" class="btn-check" name="generationMode" id="batchMode" value="batch">
                                    <label class="btn btn-outline-success" for="batchMode">
                                        <i class="fas fa-layer-group me-1"></i> Batch
                                    </label>
                                </div>
                            </div>

                            <!-- Single Topic Input with Topics Management -->
                            <div class="mb-3" id="singleTopicSection">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label mb-0">
                                        <i class="fas fa-tag me-2"></i>Topic
                                    </label>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="showTopicsManager()" title="Manage Topics">
                                            <i class="fas fa-list"></i>
                                            <span class="d-none d-sm-inline ms-1">Topics</span>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-success" onclick="openTopicsPage()" title="Add New Topic">
                                            <i class="fas fa-plus"></i>
                                            <span class="d-none d-sm-inline ms-1">New</span>
                                        </button>
                                    </div>
                                </div>
                              </div>

                            <!-- Topics Management Section (Initially Hidden) -->
                            <div class="mb-3" id="topicsManager" style="display: none;">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label mb-0">
                                        <i class="fas fa-list me-2"></i>Manage Topics
                                    </label>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="hideTopicsManager()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="border rounded p-3" style="background: var(--darker-color); max-height: 250px; overflow-y: auto;">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="newTopicInput" placeholder="Add new topic..." onkeypress="if(event.key==='Enter') addTopic()">
                                            <button type="button" class="btn btn-primary" onclick="addTopic()">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div id="topicsList" class="topics-list">
                                        <!-- Topics will be loaded here -->
                                    </div>
                                </div>
                                <div class="mt-2 text-end">
                                    <small class="text-muted">
                                        <span id="topicsCount">0</span> topics total
                                    </small>
                                </div>
                            </div>

                            <!-- Batch Topic Selection -->
                            <div class="mb-3" id="batchTopicSection" style="display: none;">
                                <label class="form-label">
                                    <i class="fas fa-list me-2"></i>Select Topics
                                </label>
                                <div class="border rounded p-2" style="max-height: 200px; overflow-y: auto; background: var(--darker-color);">
                                    <div id="topicCheckboxes">
                                        <!-- Topics will be loaded here -->
                                    </div>
                                </div>
                                <div class="mt-2 d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <span id="selectedCount">0</span> existing topics selected
                                    </small>
                                    <div>
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllTopics()">
                                            Select All
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearTopicSelection()">
                                            Clear
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Add Custom Topic Section for Batch Mode -->
                            <div class="mb-3" id="customTopicSection" style="display: none;">
                                <label class="form-label">
                                    <i class="fas fa-plus-circle me-2"></i>Add Custom Topic (Optional)
                                </label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="customTopicInput" placeholder="Enter a custom topic to include in batch generation...">
                                    <button type="button" class="btn btn-outline-success" onclick="addCustomTopic()">
                                        <i class="fas fa-plus"></i> Add
                                    </button>
                                </div>
                                <div class="mt-2">
                                    <div id="customTopicsList" class="d-flex flex-wrap gap-2">
                                        <!-- Custom topics will be displayed here -->
                                    </div>
                                </div>
                                <small class="text-muted">
                                    Add additional topics that aren't in your existing list
                                </small>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-palette me-2"></i>Style
                                </label>
                                <div class="list-group">
                                    <div class="list-group-item style-option active" onclick="selectStyle('educational', this)">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-graduation-cap me-2"></i>
                                            <div>
                                                <h6 class="mb-0">Educational</h6>
                                                <small class="text-muted">Informative and helpful content</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="list-group-item style-option" onclick="selectStyle('promotional', this)">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-bullhorn me-2"></i>
                                            <div>
                                                <h6 class="mb-0">Promotional</h6>
                                                <small class="text-muted">Marketing and sales focused</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="list-group-item style-option" onclick="selectStyle('industry_insights', this)">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-chart-line me-2"></i>
                                            <div>
                                                <h6 class="mb-0">Industry Insights</h6>
                                                <small class="text-muted">Trends and analysis</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-share-alt me-2"></i>Platforms
                                </label>
                                <div class="platform-selection">
                                    <!-- Quick select buttons -->
                                    <div class="btn-group w-100 mb-2" role="group">
                                        <button type="button" class="btn btn-outline-primary" onclick="selectAllPlatforms()">
                                            All Platforms
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" onclick="deselectAllPlatforms()">
                                            None
                                        </button>
                                    </div>

                                    <!-- Platform checkboxes -->
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="linkedin" id="linkedinCheck" checked>
                                                <label class="form-check-label" for="linkedinCheck">
                                                    <i class="fab fa-linkedin me-1"></i> LinkedIn
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="twitter" id="twitterCheck">
                                                <label class="form-check-label" for="twitterCheck">
                                                    <i class="fab fa-x-twitter me-1"></i> X
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="instagram" id="instagramCheck">
                                                <label class="form-check-label" for="instagramCheck">
                                                    <i class="fab fa-instagram me-1"></i> Instagram
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Batch Generation Settings -->
                            <div class="mb-3" id="batchSettings">
                                <label class="form-label">
                                    <i class="fas fa-sliders-h me-2"></i>Posts per Topic
                                </label>
                                <select class="form-select" id="postsPerTopic">
                                    <option value="1">1 Post per Topic</option>
                                    <option value="3">3 Posts per Topic</option>
                                    <option value="5">5 Posts per Topic</option>
                                </select>
                            </div>

                            <!-- Single Generation Settings -->
                            <div class="mb-3" id="singleSettings">
                                <label class="form-label">
                                    <i class="fas fa-copy me-2"></i>Number of Posts
                                </label>
                                <select class="form-select" id="numPostsSelect">
                                    <option value="1">1 Post</option>
                                    <option value="3">3 Posts</option>
                                    <option value="5">5 Posts</option>
                                </select>
                            </div>

                            <!-- Voice Recording Section -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-microphone me-2"></i>Voice Input (Optional)
                                </label>
                                <div class="border rounded p-3 bg-light">
                                    <div class="d-flex align-items-center justify-content-between mb-2">
                                        <small class="text-muted">Click to record your content idea</small>
                                        <div id="recordingTime" class="badge bg-danger" style="display: none;">00:00</div>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-outline-primary flex-fill" id="recordBtn" onclick="toggleRecording()">
                                            <i class="fas fa-microphone"></i>
                                            <span id="recordBtnText">Start Recording</span>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" id="playBtn" onclick="playRecording()" disabled>
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-danger" id="clearBtn" onclick="clearRecording()" disabled>
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    <div class="mt-2">
                                        <textarea class="form-control form-control-sm" id="voiceTranscript" rows="3" placeholder="Voice transcript will appear here..." readonly></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Content Generation Settings -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-brain me-2"></i>Content Generation Method
                                </label>
                                <div class="accordion" id="contentMethodAccordion">
                                    <div class="accordion-item border-0 shadow-sm">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#contentMethodCollapse">
                                                <i class="fas fa-sliders-h me-2 text-info"></i>
                                                Advanced Generation Settings
                                            </button>
                                        </h2>
                                        <div id="contentMethodCollapse" class="accordion-collapse collapse show" data-bs-parent="#contentMethodAccordion">
                                            <div class="accordion-body">
                                                <!-- Generation Method Selection -->
                                                <div class="mb-4">
                                                    <label class="form-label fw-bold">How would you like to generate content?</label>
                                                    <div class="row g-3">
                                                        <div class="col-12 col-md-6">
                                                            <div class="card border-2 h-100 method-card">
                                                                <div class="card-body text-center p-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="radio" name="generationMethod" id="instructionMethod" value="instructions" checked>
                                                                        <label class="form-check-label w-100 d-block" for="instructionMethod">
                                                                            <i class="fas fa-keyboard display-4 text-primary mb-3 d-block"></i>
                                                                            <h6 class="mb-2">Custom Instructions</h6>
                                                                            <p class="small text-muted mb-0">Provide specific instructions on how you want the content to be written</p>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-12 col-md-6">
                                                            <div class="card border-2 h-100 method-card">
                                                                <div class="card-body text-center p-3">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="radio" name="generationMethod" id="exampleMethod" value="examples">
                                                                        <label class="form-check-label w-100 d-block" for="exampleMethod">
                                                                            <i class="fas fa-copy display-4 text-success mb-3 d-block"></i>
                                                                            <h6 class="mb-2">Learn from Examples</h6>
                                                                            <p class="small text-muted mb-0">Provide existing posts and AI will generate similar content</p>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Custom Instructions Section -->
                                                <div id="instructionsSection" class="mb-4">
                                                    <label class="form-label fw-bold">
                                                        <i class="fas fa-edit text-primary me-2"></i>Custom Instructions
                                                    </label>
                                                    <textarea class="form-control" id="customInstructions" rows="6"
                                                              placeholder="Provide detailed instructions for content generation...&#10;&#10;Examples:&#10;- Write in a conversational tone like you're talking to a friend&#10;- Focus on practical tips and actionable advice&#10;- Use storytelling to explain complex concepts&#10;- Include statistics and data points to support claims&#10;- Write for beginners in the field&#10;- Use humor and relatable examples"></textarea>
                                                    <div class="mt-2">
                                                        <div class="d-grid gap-2 d-md-flex">
                                                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addInstructionTemplate()">
                                                                <i class="fas fa-lightbulb"></i> Use Template
                                                            </button>
                                                            <select class="form-select form-select-sm" id="instructionTemplate" onchange="applyInstructionTemplate()" style="display: none;">
                                                                <option value="">Choose a template...</option>
                                                                <option value="professional">Professional & Authoritative</option>
                                                                <option value="casual">Casual & Friendly</option>
                                                                <option value="educational">Educational & Informative</option>
                                                                <option value="storytelling">Storytelling & Engaging</option>
                                                                <option value="data_driven">Data-Driven & Analytical</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Examples Section -->
                                                <div id="examplesSection" class="mb-4" style="display: none;">
                                                    <label class="form-label fw-bold">
                                                        <i class="fas fa-file-alt text-success me-2"></i>Example Posts
                                                    </label>
                                                    <div class="mb-3">
                                                        <small class="text-muted">Add existing posts that you like, and the AI will generate similar content in the same style, tone, and format.</small>
                                                    </div>

                                                    <!-- Add Example Form -->
                                                    <div class="border rounded p-3 mb-3 bg-light">
                                                        <div class="row g-2">
                                                            <div class="col-12">
                                                                <input type="text" class="form-control form-control-sm" id="exampleTopic" placeholder="Example topic/title...">
                                                            </div>
                                                            <div class="col-12">
                                                                <textarea class="form-control form-control-sm" id="exampleContent" rows="4" placeholder="Paste the example post content here..."></textarea>
                                                            </div>
                                                            <div class="col-12">
                                                                <input type="text" class="form-control form-control-sm" id="exampleHashtags" placeholder="Example hashtags (optional)...">
                                                            </div>
                                                            <div class="col-12">
                                                                <div class="d-grid gap-2 d-md-flex">
                                                                    <button type="button" class="btn btn-sm btn-success flex-fill" onclick="addExample()">
                                                                        <i class="fas fa-plus"></i> Add Example
                                                                    </button>
                                                                    <button type="button" class="btn btn-sm btn-outline-info flex-fill" onclick="loadExistingExamples()">
                                                                        <i class="fas fa-download"></i> Load Examples
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Examples List -->
                                                    <div id="examplesList">
                                                        <!-- Examples will be displayed here -->
                                                    </div>

                                                    <div class="mt-3">
                                                        <small class="text-info">
                                                            <i class="fas fa-info-circle"></i>
                                                            Tip: Add 2-3 diverse examples for best results. The AI will analyze style, tone, structure, and patterns.
                                                        </small>
                                                    </div>
                                                </div>

                                                <!-- Advanced Settings -->
                                                <div class="mb-3">
                                                    <label class="form-label fw-bold">
                                                        <i class="fas fa-cog text-warning me-2"></i>Additional Settings
                                                    </label>
                                                    <div class="row g-3">
                                                        <div class="col-md-4">
                                                            <label class="form-label">Creativity Level</label>
                                                            <select class="form-select" id="creativityLevel">
                                                                <option value="conservative">Conservative (Safe & Professional)</option>
                                                                <option value="balanced" selected>Balanced (Recommended)</option>
                                                                <option value="creative">Creative (Innovative & Bold)</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label">Content Length</label>
                                                            <select class="form-select" id="contentLength">
                                                                <option value="short">Short (Quick & Punchy)</option>
                                                                <option value="medium" selected>Medium (Standard)</option>
                                                                <option value="long">Long (Detailed & In-depth)</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label">Focus Areas</label>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="focusEngagement" checked>
                                                                <label class="form-check-label" for="focusEngagement">
                                                                    High Engagement
                                                                </label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="focusSEO">
                                                                <label class="form-check-label" for="focusSEO">
                                                                    SEO Optimized
                                                                </label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="focusTrending">
                                                                <label class="form-check-label" for="focusTrending">
                                                                    Trending Topics
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Custom Formats Section -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-cog me-2"></i>Custom Format Templates
                                </label>
                                <div class="accordion" id="customFormatsAccordion">
                                    <div class="accordion-item border-0 shadow-sm">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#formatsCollapse">
                                                <i class="fas fa-magic me-2 text-primary"></i>
                                                Use Custom Format Templates
                                            </button>
                                        </h2>
                                        <div id="formatsCollapse" class="accordion-collapse collapse" data-bs-parent="#customFormatsAccordion">
                                            <div class="accordion-body">
                                                <!-- Format Type Selection -->
                                                <div class="mb-3">
                                                    <label class="form-label fw-bold">Select Format Type</label>
                                                    <select class="form-select" id="formatType" onchange="updateFormatTemplate()">
                                                        <option value="">Choose a format...</option>
                                                        <option value="listicle">ðŸ“ Listicle Post</option>
                                                        <option value="howto">ðŸ”§ How-To Guide</option>
                                                        <option value="question">â“ Q&A Style</option>
                                                        <option value="story">ðŸ“– Story-Based</option>
                                                        <option value="comparison">âš–ï¸ Comparison Post</option>
                                                        <option value="announcement">ðŸ“¢ Announcement</option>
                                                        <option value="tutorial">ðŸ“š Tutorial/Step-by-Step</option>
                                                        <option value="case_study">ðŸ“Š Case Study</option>
                                                        <option value="custom">âœï¸ Custom Format</option>
                                                    </select>
                                                </div>

                                                <!-- Custom Format Input (shown when custom is selected) -->
                                                <div class="mb-3" id="customFormatInput" style="display: none;">
                                                    <label class="form-label fw-bold">Create Custom Format</label>
                                                    <textarea class="form-control" id="customFormatTemplate" rows="4"
                                                              placeholder="Enter your custom format template...&#10;Example: &#10;Hook: {attention_grabbing_intro}&#10;Main Point: {key_message}&#10;Support: {evidence_or_example}&#10;CTA: {call_to_action}"></textarea>
                                                    <small class="text-muted">
                                                        Use variables like {topic}, {platform}, {style}, {hashtags} for dynamic content
                                                    </small>
                                                </div>

                                                <!-- Format Preview -->
                                                <div class="mb-3" id="formatPreview" style="display: none;">
                                                    <label class="form-label fw-bold">Format Preview</label>
                                                    <div class="border rounded p-3 bg-light">
                                                        <div id="formatPreviewText" class="text-muted small"></div>
                                                    </div>
                                                </div>

                                                <!-- Quick Format Templates -->
                                                <div class="mb-3">
                                                    <label class="form-label fw-bold">Quick Templates</label>
                                                    <div class="row g-2">
                                                        <div class="col-12">
                                                            <button type="button" class="btn btn-outline-primary btn-sm w-100" onclick="applyQuickTemplate('hook_problem_solution')">
                                                                ðŸŽ£ Hook â†’ Problem â†’ Solution
                                                            </button>
                                                        </div>
                                                        <div class="col-12">
                                                            <button type="button" class="btn btn-outline-info btn-sm w-100" onclick="applyQuickTemplate('tip_stat_cta')">
                                                                ðŸ’¡ Tip â†’ Statistic â†’ CTA
                                                            </button>
                                                        </div>
                                                        <div class="col-12">
                                                            <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="applyQuickTemplate('question_answer_insight')">
                                                                â“ Question â†’ Answer â†’ Insight
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Structured Topic Creation Section -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-layer-group me-2"></i>Advanced Topic Builder
                                </label>
                                <div class="accordion" id="topicBuilderAccordion">
                                    <div class="accordion-item border-0 shadow-sm">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#topicBuilderCollapse">
                                                <i class="fas fa-tools me-2 text-warning"></i>
                                                Build Structured Topics
                                            </button>
                                        </h2>
                                        <div id="topicBuilderCollapse" class="accordion-collapse collapse" data-bs-parent="#topicBuilderAccordion">
                                            <div class="accordion-body">
                                                <!-- Topic Input Fields -->
                                                <div class="row g-3">
                                                    <div class="col-md-6">
                                                        <label class="form-label">Main Topic</label>
                                                        <input type="text" class="form-control" id="mainTopic" placeholder="e.g., AI in Healthcare">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">Target Audience</label>
                                                        <select class="form-select" id="targetAudience">
                                                            <option value="">Select audience...</option>
                                                            <option value="general">General Public</option>
                                                            <option value="professionals">Professionals</option>
                                                            <option value="experts">Industry Experts</option>
                                                            <option value="beginners">Beginners</option>
                                                            <option value="executives">Executives</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">Content Goal</label>
                                                        <select class="form-select" id="contentGoal">
                                                            <option value="">Select goal...</option>
                                                            <option value="educate">Educate</option>
                                                            <option value="entertain">Entertain</option>
                                                            <option value="inspire">Inspire</option>
                                                            <option value="persuade">Persuade</option>
                                                            <option value="inform">Inform</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">Tone of Voice</label>
                                                        <select class="form-select" id="toneOfVoice">
                                                            <option value="">Select tone...</option>
                                                            <option value="professional">Professional</option>
                                                            <option value="casual">Casual</option>
                                                            <option value="formal">Formal</option>
                                                            <option value="friendly">Friendly</option>
                                                            <option value="humorous">Humorous</option>
                                                        </select>
                                                    </div>
                                                </div>

                                                <!-- Key Points Input -->
                                                <div class="mt-3">
                                                    <label class="form-label">Key Points to Cover</label>
                                                    <div id="keyPointsContainer">
                                                        <div class="input-group mb-2">
                                                            <input type="text" class="form-control" placeholder="Enter a key point...">
                                                            <button type="button" class="btn btn-success" onclick="addKeyPoint()">
                                                                <i class="fas fa-plus"></i> Add
                                                            </button>
                                                        </div>
                                                        <div id="keyPointsList" class="mb-3">
                                                            <!-- Key points will be listed here -->
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Call to Action -->
                                                <div class="mt-3">
                                                    <label class="form-label">Call to Action</label>
                                                    <input type="text" class="form-control" id="callToAction" placeholder="e.g., Visit our website, Learn more, Sign up now">
                                                </div>

                                                <!-- Generate Structured Topic Button -->
                                                <div class="mt-3 text-end">
                                                    <button type="button" class="btn btn-primary" onclick="generateStructuredTopic()">
                                                        <i class="fas fa-magic"></i> Generate Topic from Structure
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Generated Content -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-0">Generated Content</h5>
                    </div>
                    <div class="card-body">
                        <div id="generatedContent">
                            <div class="text-center py-5">
                                <i class="fas fa-magic display-1 text-muted"></i>
                                <h4 class="mt-3 text-muted">Ready to Generate</h4>
                                <p class="text-muted">Fill in the form and click "Generate Content" to create professional posts</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Topic Modal -->
    <div class="modal fade" id="addTopicModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-plus-circle me-2"></i>Add New Content Topic
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addTopicForm">
                        <!-- Topic Name Section -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-heading text-primary me-2"></i>Topic Name
                            </label>
                            <input type="text" class="form-control form-control-lg" id="newTopicModalName"
                                   placeholder="Enter your content topic..." required>
                            <small class="text-muted">Example: "AI Trends in Digital Marketing"</small>
                        </div>

                        <!-- Description Section -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-align-left text-info me-2"></i>Description
                            </label>
                            <textarea class="form-control" id="newTopicModalDescription" rows="4"
                                      placeholder="Describe what this topic covers and why it's valuable..."></textarea>
                            <small class="text-muted">Optional: Brief description of the content focus</small>
                        </div>

                        <!-- Key Points Section -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-list text-success me-2"></i>Key Points
                            </label>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="newKeyPointInput"
                                       placeholder="Add a key point about this topic..." onkeypress="if(event.key==='Enter') addModalKeyPoint()">
                                <button type="button" class="btn btn-success" onclick="addModalKeyPoint()">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            <div id="newKeyPointsList" class="mb-3">
                                <!-- Key points will be displayed here -->
                            </div>
                        </div>

                        <!-- Style Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-palette text-warning me-2"></i>Content Style
                            </label>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="newTopicStyle" id="newEducational" value="educational" checked>
                                        <label class="form-check-label" for="newEducational">
                                            <i class="fas fa-graduation-cap me-2"></i>Educational
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="newTopicStyle" id="newPromotional" value="promotional">
                                        <label class="form-check-label" for="newPromotional">
                                            <i class="fas fa-bullhorn me-2"></i>Promotional
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="newTopicStyle" id="newProfessional" value="professional">
                                        <label class="form-check-label" for="newProfessional">
                                            <i class="fas fa-briefcase me-2"></i>Professional
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Preview Section -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-eye text-secondary me-2"></i>Preview
                            </label>
                            <div class="border rounded p-3" style="background: var(--darker-color);">
                                <h6 class="text-primary mb-2">Topic Preview</h6>
                                <div id="newTopicPreview">
                                    <p class="text-muted mb-1">Enter topic name to see preview...</p>
                                    <div class="text-muted small">Add key points to enhance the content generation...</div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-primary" onclick="saveNewTopic()">
                        <i class="fas fa-save"></i> Add Topic
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        let selectedStyle = 'educational';
        let availableTopics = [];
        let selectedTopics = new Set();
        let customTopics = new Set();

        // Voice Recording Variables
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let recordingTimer;
        let recordingStartTime;
        let audioBlob;
        let audioUrl;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadTopics();
            setupModeToggle();
        });

        // Setup mode toggle between single and batch
        function setupModeToggle() {
            const singleMode = document.getElementById('singleMode');
            const batchMode = document.getElementById('batchMode');

            singleMode.addEventListener('change', function() {
                if (this.checked) {
                    showSingleMode();
                }
            });

            batchMode.addEventListener('change', function() {
                if (this.checked) {
                    showBatchMode();
                }
            });

            // Initially show single mode
            showSingleMode();
        }

        function showSingleMode() {
            document.getElementById('singleTopicSection').style.display = 'block';
            document.getElementById('batchTopicSection').style.display = 'none';
            document.getElementById('batchSettings').style.display = 'none';
            document.getElementById('singleSettings').style.display = 'block';
        }

        function showBatchMode() {
            document.getElementById('singleTopicSection').style.display = 'none';
            document.getElementById('batchTopicSection').style.display = 'block';
            document.getElementById('customTopicSection').style.display = 'block';
            document.getElementById('batchSettings').style.display = 'block';
            document.getElementById('singleSettings').style.display = 'none';
        }

        // Load topics from API
        function loadTopics() {
            fetch('/api/topics')
                .then(response => response.json())
                .then(data => {
                    availableTopics = data;
                    renderTopicCheckboxes();
                })
                .catch(error => {
                    console.error('Error loading topics:', error);
                    availableTopics = [];
                    renderTopicCheckboxes();
                });
        }

        function renderTopicCheckboxes() {
            const container = document.getElementById('topicCheckboxes');

            if (availableTopics.length === 0) {
                container.innerHTML = '<div class="text-muted p-3">No topics available. Add topics first.</div>';
                return;
            }

            container.innerHTML = availableTopics.map((topic, index) => `
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" value="${index}" id="topic_${index}"
                           onchange="toggleTopicSelection(${index})">
                    <label class="form-check-label" for="topic_${index}">
                        <div>
                            <strong>${topic.topic}</strong>
                            <br><small class="text-muted">${topic.points ? topic.points[0] : 'No description available'}</small>
                        </div>
                    </label>
                </div>
            `).join('');
        }

        function toggleTopicSelection(index) {
            const checkbox = document.getElementById(`topic_${index}`);
            if (checkbox.checked) {
                selectedTopics.add(index);
            } else {
                selectedTopics.delete(index);
            }
            updateSelectedCount();
        }

        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedTopics.size;
        }

        function selectAllTopics() {
            availableTopics.forEach((topic, index) => {
                const checkbox = document.getElementById(`topic_${index}`);
                if (checkbox) {
                    checkbox.checked = true;
                    selectedTopics.add(index);
                }
            });
            updateSelectedCount();
        }

        function clearTopicSelection() {
            availableTopics.forEach((topic, index) => {
                const checkbox = document.getElementById(`topic_${index}`);
                if (checkbox) {
                    checkbox.checked = false;
                }
            });
            selectedTopics.clear();
            updateSelectedCount();
        }

        function refreshTopics() {
            loadTopics();
            showNotification('Topics refreshed', 'info');
        }

        // Topics Management Functions
        function showTopicsManager() {
            document.getElementById('topicsManager').style.display = 'block';
            loadTopicsForManager();
        }

        function hideTopicsManager() {
            document.getElementById('topicsManager').style.display = 'none';
        }

        function loadTopicsForManager() {
            fetch('/api/topics')
                .then(response => response.json())
                .then(data => {
                    renderTopicsForManager(data);
                    updateTopicsCount(data.length);
                })
                .catch(error => {
                    console.error('Error loading topics:', error);
                    renderTopicsForManager([]);
                    updateTopicsCount(0);
                });
        }

        function renderTopicsForManager(topics) {
            const container = document.getElementById('topicsList');

            if (topics.length === 0) {
                container.innerHTML = '<div class="text-muted p-3">No topics available. Add your first topic above.</div>';
                return;
            }

            container.innerHTML = topics.map((topic, index) => `
                <div class="topic-item mb-2 p-2 rounded" style="background: var(--card-bg); border: 1px solid var(--card-border);">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <strong class="text-primary">${topic.topic}</strong>
                            ${topic.points && topic.points[0] ? `<br><small class="text-muted">${topic.points[0]}</small>` : ''}
                        </div>
                        <div class="btn-group btn-group-sm">
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="useTopicInInput('${topic.topic}')" title="Use this topic">
                                <i class="fas fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-outline-danger btn-sm" onclick="deleteTopic(${index})" title="Delete topic">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function useTopicInInput(topicName) {
            document.getElementById('topicInput').value = topicName;
            showNotification(`Topic "${topicName}" loaded in input field`, 'success');
        }

        function addTopic() {
            const input = document.getElementById('newTopicInput');
            const topicName = input.value.trim();

            if (!topicName) {
                showNotification('Please enter a topic name', 'warning');
                return;
            }

            fetch('/api/topics', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    topic: topicName,
                    points: [`Content about ${topicName}`],
                    style: selectedStyle
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    input.value = '';
                    loadTopicsForManager();
                    loadTopics(); // Refresh topics in batch mode
                    showNotification('Topic added successfully!', 'success');
                } else {
                    showNotification(`Failed to add topic: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error adding topic:', error);
                showNotification('Error adding topic', 'error');
            });
        }

        function deleteTopic(index) {
            if (!confirm('Are you sure you want to delete this topic?')) {
                return;
            }

            fetch('/api/topics', {
                method: 'GET' // Assuming the API has a way to identify topics by index
            })
            .then(response => response.json())
            .then(data => {
                if (data[index] && data[index].id) {
                    // Delete topic by ID if available
                    return fetch(`/api/topics/${data[index].id}`, {
                        method: 'DELETE'
                    });
                } else {
                    throw new Error('Topic ID not found');
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadTopicsForManager();
                    loadTopics(); // Refresh topics in batch mode
                    showNotification('Topic deleted successfully!', 'success');
                } else {
                    showNotification(`Failed to delete topic: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error deleting topic:', error);
                showNotification('Error deleting topic', 'error');
            });
        }

        function updateTopicsCount(count) {
            document.getElementById('topicsCount').textContent = count;
        }

        function openTopicsPage() {
            // Open the Add Topic modal
            const modal = new bootstrap.Modal(document.getElementById('addTopicModal'));
            modal.show();
            resetTopicModalForm();
        }

        // Add Topic Modal Functions
        let modalKeyPoints = [];

        function resetTopicModalForm() {
            // Reset form fields
            document.getElementById('newTopicModalName').value = '';
            document.getElementById('newTopicModalDescription').value = '';
            document.getElementById('newKeyPointInput').value = '';

            // Reset key points
            modalKeyPoints = [];
            updateModalKeyPointsList();

            // Reset radio buttons to default
            const educationalStyle = document.getElementById('newEducational');
            if (educationalStyle) educationalStyle.checked = true;

            // Reset preview
            updateModalTopicPreview();
        }

        function addModalKeyPoint() {
            const keyPointInput = document.getElementById('newKeyPointInput');
            const keyPoint = keyPointInput.value.trim();

            if (keyPoint) {
                modalKeyPoints.push(keyPoint);
                updateModalKeyPointsList();
                keyPointInput.value = '';
                updateModalTopicPreview();
            }
        }

        function removeModalKeyPoint(index) {
            modalKeyPoints.splice(index, 1);
            updateModalKeyPointsList();
            updateModalTopicPreview();
        }

        function updateModalKeyPointsList() {
            const container = document.getElementById('newKeyPointsList');

            if (modalKeyPoints.length === 0) {
                container.innerHTML = '<div class="text-muted p-2">No key points added yet. Add key points to enhance content generation.</div>';
                return;
            }

            container.innerHTML = modalKeyPoints.map((point, index) => `
                <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded" style="background: var(--card-bg); border: 1px solid var(--card-border);">
                    <span class="flex-grow-1">${point}</span>
                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeModalKeyPoint(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function updateModalTopicPreview() {
            const preview = document.getElementById('newTopicPreview');
            const topicName = document.getElementById('newTopicModalName').value;
            const description = document.getElementById('newTopicModalDescription').value;
            const selectedStyle = document.querySelector('input[name="newTopicStyle"]:checked')?.value || 'educational';

            if (!topicName) {
                preview.innerHTML = '<p class="text-muted mb-1">Enter topic name to see preview...</p><div class="text-muted small">Add key points to enhance the content generation...</div>';
                return;
            }

            let styleIcon = '';
            let styleText = '';
            switch(selectedStyle) {
                case 'educational':
                    styleIcon = '<i class="fas fa-graduation-cap me-2"></i>';
                    styleText = 'Educational';
                    break;
                case 'promotional':
                    styleIcon = '<i class="fas fa-bullhorn me-2"></i>';
                    styleText = 'Promotional';
                    break;
                case 'professional':
                    styleIcon = '<i class="fas fa-briefcase me-2"></i>';
                    styleText = 'Professional';
                    break;
                default:
                    styleIcon = '<i class="fas fa-pen me-2"></i>';
                    styleText = selectedStyle;
            }

            let keyPointsHtml = '';
            if (modalKeyPoints.length > 0) {
                keyPointsHtml = `
                    <div class="mt-2">
                        <small class="text-muted">Key Points:</small>
                        <ul class="mb-0 ps-3">
                            ${modalKeyPoints.map(point => `<li class="small">${point}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            let descriptionHtml = '';
            if (description) {
                descriptionHtml = `<p class="small text-muted mb-1">${description}</p>`;
            }

            preview.innerHTML = `
                <div class="d-flex align-items-center mb-2">
                    <strong class="text-primary">${topicName}</strong>
                    <span class="ms-auto badge bg-secondary">${styleIcon}${styleText}</span>
                </div>
                ${descriptionHtml}
                ${keyPointsHtml}
                <div class="text-muted small mt-2">
                    <i class="fas fa-info-circle me-1"></i>
                    This topic will be available for content generation across all platforms
                </div>
            `;
        }

        function saveNewTopic() {
            const topicName = document.getElementById('newTopicModalName').value.trim();
            const description = document.getElementById('newTopicModalDescription').value.trim();
            const selectedStyle = document.querySelector('input[name="newTopicStyle"]:checked')?.value || 'educational';

            if (!topicName) {
                showNotification('Please enter a topic name', 'warning');
                return;
            }

            const topicData = {
                topic: topicName,
                description: description,
                points: modalKeyPoints,
                style: selectedStyle
            };

            fetch('/api/topics', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(topicData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addTopicModal'));
                    modal.hide();

                    // Reset form
                    resetTopicModalForm();

                    // Refresh topics in both manager and batch mode
                    loadTopicsForManager();
                    loadTopics();

                    showNotification('Topic added successfully!', 'success');
                } else {
                    showNotification(`Failed to add topic: ${data.error || data.message}`, 'error');
                }
            })
            .catch(error => {
                console.error('Error adding topic:', error);
                showNotification('Error adding topic', 'error');
            });
        }

        // Add event listeners for real-time preview
        document.addEventListener('DOMContentLoaded', function() {
            // Topic name input
            document.getElementById('newTopicModalName')?.addEventListener('input', updateModalTopicPreview);

            // Description input
            document.getElementById('newTopicModalDescription')?.addEventListener('input', updateModalTopicPreview);

            // Style selection
            document.querySelectorAll('input[name="newTopicStyle"]').forEach(radio => {
                radio.addEventListener('change', updateModalTopicPreview);
            });
        });

        // Custom topic functions
        function addCustomTopic() {
            const input = document.getElementById('customTopicInput');
            const topic = input.value.trim();

            if (!topic) {
                showNotification('Please enter a topic', 'warning');
                return;
            }

            if (customTopics.has(topic)) {
                showNotification('Topic already added', 'warning');
                return;
            }

            customTopics.add(topic);
            input.value = '';
            updateCustomTopicsDisplay();
            showNotification('Custom topic added', 'success');
        }

        function updateCustomTopicsDisplay() {
            const container = document.getElementById('customTopicsList');

            if (customTopics.size === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = Array.from(customTopics).map(topic => `
                <span class="badge bg-primary d-inline-flex align-items-center gap-1" style="background: var(--primary-color) !important;">
                    ${topic}
                    <button type="button" class="btn-close btn-close-white btn-sm" onclick="removeCustomTopic('${topic}')" style="font-size: 0.6rem;"></button>
                </span>
            `).join('');
        }

        function removeCustomTopic(topic) {
            customTopics.delete(topic);
            updateCustomTopicsDisplay();
        }

        // Allow Enter key to add custom topic
        document.getElementById('customTopicInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addCustomTopic();
            }
        });

        // Voice Recording Functions
        async function toggleRecording() {
            if (!isRecording) {
                await startRecording();
            } else {
                stopRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = async () => {
                    audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    audioUrl = URL.createObjectURL(audioBlob);
                    document.getElementById('playBtn').disabled = false;
                    document.getElementById('clearBtn').disabled = false;

                    // Transcribe audio using ZAI API
                    await transcribeAudio();
                };

                mediaRecorder.start();
                isRecording = true;
                recordingStartTime = Date.now();

                // Update UI
                document.getElementById('recordBtn').classList.remove('btn-outline-primary');
                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordBtnText').textContent = 'Stop Recording';
                document.getElementById('recordingTime').style.display = 'inline-block';

                // Start timer
                updateRecordingTimer();

            } catch (error) {
                console.error('Error accessing microphone:', error);
                showNotification('Failed to access microphone. Please check permissions.', 'error');
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                isRecording = false;

                // Update UI
                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordBtn').classList.add('btn-outline-primary');
                document.getElementById('recordBtnText').textContent = 'Start Recording';
                document.getElementById('recordingTime').style.display = 'none';

                // Clear timer
                clearInterval(recordingTimer);
            }
        }

        function updateRecordingTimer() {
            recordingTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const seconds = (elapsed % 60).toString().padStart(2, '0');
                document.getElementById('recordingTime').textContent = `${minutes}:${seconds}`;
            }, 1000);
        }

        async function transcribeAudio() {
            try {
                const formData = new FormData();
                formData.append('audio', audioBlob, 'recording.wav');

                const response = await fetch('/api/transcribe/audio', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.transcript) {
                        document.getElementById('voiceTranscript').value = data.transcript;
                        // Also update the topic input with the transcribed text
                        document.getElementById('topicInput').value = data.transcript;
                        showNotification('Voice transcribed successfully!', 'success');
                    } else {
                        throw new Error(data.message || 'Transcription failed');
                    }
                } else {
                    throw new Error('Transcription service unavailable');
                }
            } catch (error) {
                console.error('Transcription error:', error);
                showNotification('Failed to transcribe audio. You can still use the recorded text manually.', 'warning');
                // Fallback: let user know they can still use the recording manually
            }
        }

        function playRecording() {
            if (audioUrl) {
                const audio = new Audio(audioUrl);
                audio.play();
            }
        }

        function clearRecording() {
            // Clear all recording data
            audioBlob = null;
            audioUrl = null;
            audioChunks = [];

            // Reset UI
            document.getElementById('voiceTranscript').value = '';
            document.getElementById('playBtn').disabled = true;
            document.getElementById('clearBtn').disabled = true;

            showNotification('Recording cleared', 'info');
        }

        function selectStyle(style, element) {
            selectedStyle = style;
            document.querySelectorAll('.style-option').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
        }

        function startGeneration() {
            const topic = document.getElementById('topicInput')?.value;
            const selectedPlatforms = document.querySelectorAll('.platform-item input:checked');
            const platforms = Array.from(selectedPlatforms).map(cb => cb.value);

            if (!topic || topic.trim() === '') {
                showNotification('Please enter a topic', 'warning');
                return;
            }

            if (platforms.length === 0) {
                showNotification('Please select at least one platform', 'warning');
                return;
            }

            // Show loading state
            const container = document.getElementById('generatedContent');
            if (container) {
                container.innerHTML = `
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <h3>Generating Content...</h3>
                        <p>Creating amazing content for ${platforms.join(', ')}</p>
                    </div>
                `;
            }

            // Simulate generation (in real app, this would call your backend API)
            setTimeout(() => {
                const samplePosts = generateSamplePosts(topic, platforms);
                displayGeneratedContent(samplePosts);
                showNotification(`Generated ${samplePosts.length} posts successfully!`, 'success');
            }, 2000);
        }

        // Generate sample posts for testing
        function generateSamplePosts(topic, platforms) {
            const posts = [];
            const styles = ['Educational', 'Promotional', 'Engaging'];
            const templates = [
                `ðŸš€ **${topic}: Your Complete Guide**\n\nDiscover everything you need to know about ${topic.toLowerCase()} in this comprehensive guide. We'll cover key strategies, best practices, and expert tips to help you succeed.\n\nðŸ’¡ Key takeaways:\nâ€¢ Why ${topic.toLowerCase()} matters now\nâ€¢ Step-by-step implementation\nâ€¢ Common mistakes to avoid\nâ€¢ Future trends to watch\n\nReady to dive in? Let me know your thoughts below! ðŸ‘‡\n\n#${topic.replace(/\s+/g, '')} #Guides #ExpertTips`,
                `ðŸŽ¯ **Quick Win: ${topic} in 5 Steps**\n\nWant to master ${topic.toLowerCase()} quickly? Here's your fast track to success:\n\n1ï¸âƒ£ Research & Planning\n2ï¸âƒ£ Core Strategy Development\n3ï¸âƒ£ Implementation Framework\n4ï¸âƒ£ Measurement & Optimization\n5ï¸âƒ£ Scale & Refine\n\nEach step builds on the previous one - skip at your own risk! ðŸ˜‰\n\nWhich step are you currently on? Let me know in the comments! ðŸ‘‡\n\n#${topic.replace(/\s+/g, '')} #QuickTips #Strategy`,
                `ðŸ’¡ **${topic}: Are You Making These Mistakes?**\n\nCommon pitfalls I see with ${topic.toLowerCase()} (and how to avoid them):\n\nâŒ **Rushing the process** â†’ Take time to plan\nâŒ **Ignoring data** â†’ Track everything that matters\nâŒ **Going it alone** -> Build a support network\nâŒ **Perfectionism** â†’ Progress over perfection\n\nâœ… **What's working**: Consistent effort + smart strategy\n\nHave you encountered any of these? Share your experience! ðŸ—£ï¸\n\n#${topic.replace(/\s+/g, '')} #Mistakes #Learning`
            ];

            platforms.forEach(platform => {
                const template = templates[Math.floor(Math.random() * templates.length)];
                const style = styles[Math.floor(Math.random() * styles.length)];
                const hashtags = `#${topic.replace(/\s+/g, '')} #${platform} #${style.toLowerCase()}`;

                posts.push({
                    platform: platform,
                    content: template,
                    hashtags: hashtags,
                    topic: topic,
                    style: style
                });
            });

            return posts;
        }

        function getSelectedPlatforms() {
            const platforms = [];
            const checkboxes = ['linkedinCheck', 'twitterCheck', 'instagramCheck'];

            checkboxes.forEach(checkboxId => {
                const checkbox = document.getElementById(checkboxId);
                if (checkbox.checked) {
                    platforms.push(checkbox.value);
                }
            });

            return platforms;
        }

        function selectAllPlatforms() {
            document.getElementById('linkedinCheck').checked = true;
            document.getElementById('twitterCheck').checked = true;
            document.getElementById('instagramCheck').checked = true;
        }

        function deselectAllPlatforms() {
            document.getElementById('linkedinCheck').checked = false;
            document.getElementById('twitterCheck').checked = false;
            document.getElementById('instagramCheck').checked = false;
        }

        function generateSingleContent(platforms) {
            const topic = document.getElementById('topicInput').value.trim();
            const numPosts = parseInt(document.getElementById('numPostsSelect').value);

            if (!topic) {
                showNotification('Please enter a topic', 'warning');
                return;
            }

            generatePostsForMultiplePlatforms(topic, platforms, numPosts, false);
        }

        function generateBatchContent(platforms) {
            const postsPerTopic = parseInt(document.getElementById('postsPerTopic').value);

            if (selectedTopics.size === 0 && customTopics.size === 0) {
                showNotification('Please select at least one topic or add a custom topic', 'warning');
                return;
            }

            // Combine selected existing topics and custom topics
            const selectedTopicData = Array.from(selectedTopics).map(index => availableTopics[index]);
            const customTopicData = Array.from(customTopics).map(topic => ({
                topic: topic,
                points: [`Content about ${topic}`],
                style: selectedStyle,
                created_date: new Date().toISOString()
            }));

            const allTopics = [...selectedTopicData, ...customTopicData];

            generatePostsForMultipleTopics(allTopics, platforms, postsPerTopic);
        }

        function generatePostsForMultiplePlatforms(topic, platforms, numPosts, isBatchMode) {
            const container = document.getElementById('generatedContent');
            const totalPosts = platforms.length * numPosts;

            container.innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Generating content...</span>
                    </div>
                    <p class="mt-2 text-muted">
                        ${isBatchMode ? `Generating ${totalPosts} posts for batch...` : `Generating ${totalPosts} post${totalPosts > 1 ? 's' : ''} about "${topic}" across ${platforms.length} platform${platforms.length > 1 ? 's' : ''}...`}
                    </p>
                    <small class="text-muted">Platforms: ${platforms.map(p => p === 'twitter' ? 'X' : p.charAt(0).toUpperCase() + p.slice(1)).join(', ')}</small>
                </div>
            `;

            const promises = platforms.map(platform => {
                return fetch('/api/generate/content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        topic: topic,
                        style: selectedStyle,
                        platform: platform,
                        num_posts: numPosts,
                        use_fast: true
                    })
                })
                .then(response => response.json())
                .then(data => ({ platform, data }));
            });

            Promise.all(promises)
                .then(results => {
                    container.innerHTML = '';
                    let allContent = [];

                    results.forEach(({ platform, data }) => {
                        if (data.success) {
                            const platformIcon = platform === 'linkedin' ? 'fab fa-linkedin' : platform === 'twitter' ? 'fab fa-x-twitter' : 'fab fa-instagram';
                            const platformName = platform === 'twitter' ? 'X' : platform.charAt(0).toUpperCase() + platform.slice(1);

                            // Handle different response formats
                            let contentArray = [];
                            if (data.posts && Array.isArray(data.posts)) {
                                contentArray = data.posts.map(post => post.content || post);
                            } else if (data.content && Array.isArray(data.content)) {
                                contentArray = data.content;
                            } else if (data.content) {
                                contentArray = [data.content];
                            }

                            if (contentArray.length > 0) {
                                const platformHtml = `
                                    <div class="generated-content mb-4">
                                        <h6 class="text-success mb-3">
                                            <i class="${platformIcon} me-2"></i>${platformName} (${contentArray.length} post${contentArray.length > 1 ? 's' : ''})
                                        </h6>
                                        ${contentArray.map((content, idx) => `
                                            <div class="mb-3">
                                                <small class="text-muted d-block mb-1">Post ${idx + 1}</small>
                                                <div>${content.replace(/\n/g, '<br>')}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                `;
                                allContent.push(platformHtml);
                            }
                        }
                    });

                    if (allContent.length > 0) {
                        container.innerHTML = allContent.join('');
                        showNotification(`Successfully generated ${totalPosts} posts across ${platforms.length} platforms!`, 'success');
                    } else {
                        showError('Failed to generate content for any platform');
                    }
                })
                .catch(error => {
                    console.error('Error generating content:', error);
                    showError('Failed to generate content');
                });
        }

        function generatePostsForTopic(topic, platform, numPosts, isBatchMode) {
            const container = document.getElementById('generatedContent');

            container.innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Generating content...</span>
                    </div>
                    <p class="mt-2 text-muted">
                        ${isBatchMode ? `Generating ${numPosts} posts for batch...` : `Generating ${numPosts} post${numPosts > 1 ? 's' : ''} about "${topic}"...`}
                    </p>
                    <div class="progress mb-3" style="height: 4px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                    </div>
                </div>
            `;

            fetch('/api/generate/content', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    topic: topic,
                    style: selectedStyle,
                    platform: platform,
                    num_posts: numPosts,
                    use_fast: true
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Handle different response formats
                    let contentArray = [];
                    if (data.posts && Array.isArray(data.posts)) {
                        contentArray = data.posts.map(post => post.content || post);
                    } else if (data.content && Array.isArray(data.content)) {
                        contentArray = data.content;
                    } else if (data.content) {
                        contentArray = [data.content];
                    }

                    if (contentArray.length > 0) {
                        displayGeneratedContent(contentArray, numPosts > 1 || isBatchMode);
                    } else {
                        showError('No content was generated');
                    }
                } else {
                    showError('Failed to generate content: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error generating content:', error);
                showError('Failed to generate content');
            });
        }

        function generatePostsForMultipleTopics(topics, platforms, postsPerTopic) {
            const container = document.getElementById('generatedContent');
            const totalPosts = topics.length * postsPerTopic * platforms.length;

            container.innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Batch generating content...</span>
                    </div>
                    <p class="mt-2 text-muted">
                        Batch generating ${totalPosts} posts from ${topics.length} topics across ${platforms.length} platform${platforms.length > 1 ? 's' : ''}...
                    </p>
                    <small class="text-muted">Platforms: ${platforms.map(p => p === 'twitter' ? 'X' : p.charAt(0).toUpperCase() + p.slice(1)).join(', ')}</small>
                    <div class="progress mb-3" style="height: 6px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 100%"></div>
                    </div>
                    <small class="text-muted">
                        <i class="fas fa-clock me-1"></i>
                        Estimated time: ${Math.ceil(totalPosts * 10 / 60)} minutes
                    </small>
                </div>
            `;

            // Process each platform separately for batch generation
            const promises = platforms.map(platform => {
                return fetch('/api/generate/content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        topics: topics,
                        style: selectedStyle,
                        platform: platform,
                        num_posts: postsPerTopic,
                        use_fast: true
                    })
                })
                .then(response => response.json())
                .then(data => ({ platform, data }));
            });

            Promise.all(promises)
            .then(results => {
                container.innerHTML = '';
                let allContent = [];
                let totalGenerated = 0;

                results.forEach(({ platform, data }) => {
                    if (data.success) {
                        if (data.status === 'generating') {
                            // For now, show success message since fast generator should work quickly
                            const platformIcon = platform === 'linkedin' ? 'fab fa-linkedin' : platform === 'twitter' ? 'fab fa-x-twitter' : 'fab fa-instagram';
                            const platformName = platform === 'twitter' ? 'X' : platform.charAt(0).toUpperCase() + platform.slice(1);

                            allContent.push(`
                                <div class="generated-content mb-4">
                                    <h6 class="text-success mb-3">
                                        <i class="${platformIcon} me-2"></i>${platformName} - Generation Started
                                    </h6>
                                    <p class="text-muted">Generating ${topics.length * postsPerTopic} posts for ${platformName}...</p>
                                </div>
                            `);
                        } else if (data.content) {
                            const platformIcon = platform === 'linkedin' ? 'fab fa-linkedin' : platform === 'twitter' ? 'fab fa-x-twitter' : 'fab fa-instagram';
                            const platformName = platform === 'twitter' ? 'X' : platform.charAt(0).toUpperCase() + platform.slice(1);

                            totalGenerated += Array.isArray(data.content) ? data.content.length : 1;

                            allContent.push(`
                                <div class="generated-content mb-4">
                                    <h6 class="text-success mb-3">
                                        <i class="${platformIcon} me-2"></i>${platformName}
                                    </h6>
                                    ${Array.isArray(data.content) ? data.content.map((content, idx) => `
                                        <div class="mb-3">
                                            <small class="text-muted d-block mb-1">Post ${idx + 1}</small>
                                            <div>${content.replace(/\n/g, '<br>')}</div>
                                        </div>
                                    `).join('') : data.content.replace(/\n/g, '<br>')}
                                </div>
                            `);
                        }
                    } else {
                        showError(`Failed to generate content for ${platform}: ${data.message || 'Unknown error'}`);
                    }
                });

                if (allContent.length > 0) {
                    container.innerHTML = allContent.join('');
                    showNotification(`Batch generation completed! Generated content for ${results.length} platforms.`, 'success');
                } else {
                    showError('Failed to generate content for any platform');
                }
            })
            .catch(error => {
                console.error('Error starting batch generation:', error);
                showError('Failed to start batch generation');
            });
        }

        function displayGeneratedContent(contentArray, isBatch = false) {
            const container = document.getElementById('generatedContent');

            if (contentArray.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle"></i> No content was generated
                    </div>
                `;
                return;
            }

            // Add header for batch results
            let headerHtml = '';
            if (isBatch) {
                headerHtml = `
                    <div class="alert alert-success d-flex justify-content-between align-items-center" role="alert">
                        <div>
                            <i class="fas fa-check-circle me-2"></i>
                            Successfully generated ${contentArray.length} posts!
                        </div>
                        <button class="btn btn-sm btn-light" onclick="copyAllContent(${contentArray.length})">
                            <i class="fas fa-copy me-1"></i> Copy All
                        </button>
                    </div>
                `;
            }

            container.innerHTML = headerHtml + contentArray.map((content, index) => `
                <div class="generated-content mb-4">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6>${isBatch ? `Post ${index + 1}` : 'Generated Post'}</h6>
                        <div>
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyContent(${index})">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    </div>
                    <div class="mb-2">${formatContent(content)}</div>
                    <small class="text-muted">
                        <i class="fas fa-clock"></i> Generated ${new Date().toLocaleTimeString()}
                    </small>
                </div>
            `).join('');
        }

        function copyAllContent(contentCount) {
            let allContent = '';
            for (let i = 0; i < contentCount; i++) {
                const postElement = document.querySelectorAll('.generated-content')[i];
                if (postElement) {
                    const content = postElement.querySelector('.mb-2').innerText;
                    allContent += `Post ${i + 1}:\n${content}\n\n`;
                }
            }

            navigator.clipboard.writeText(allContent.trim()).then(() => {
                showNotification('All posts copied to clipboard!', 'success');
            }).catch(err => {
                showNotification('Failed to copy all content', 'error');
            });
        }

        function formatContent(content) {
            return content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n\s*\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                .replace(/^(.*)$/, '<p>$1</p>')
                .replace(/<p><\/p>/g, ''); // Remove empty paragraphs
        }

        function copyContent(index) {
            const contentDivs = document.querySelectorAll('.generated-content');
            if (contentDivs[index]) {
                // Get the text content from the div, excluding the copy button
                const contentElement = contentDivs[index].querySelector('div');
                if (contentElement) {
                    // Strip HTML tags and copy plain text
                    const textContent = contentElement.textContent || contentElement.innerText;
                    navigator.clipboard.writeText(textContent)
                        .then(() => {
                            showNotification('Content copied to clipboard!', 'success');
                        })
                        .catch(err => {
                            showNotification('Failed to copy content', 'error');
                        });
                }
            }
        }

        function pollForGeneratedContent(topic, platform, numPosts) {
            const maxAttempts = 30; // Poll for up to 5 minutes (30 * 10 seconds)
            let attempts = 0;

            const poll = setInterval(() => {
                attempts++;

                fetch(`/api/generator/latest?platform=${platform}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success && data.content && data.content.length > 0) {
                            clearInterval(poll);
                            // Extract content text from content objects and filter out empty content
                            const posts = data.content
                                .map(item => item.content)
                                .filter(content => content && content.trim() !== '' && content !== '\n');

                            if (posts.length > 0) {
                                displayGeneratedContent(posts);
                                showNotification(`Successfully generated ${posts.length} posts!`, 'success');
                            } else {
                                showError('Generated content was empty. Please try again.');
                            }
                        } else if (attempts >= maxAttempts) {
                            clearInterval(poll);
                            showError('Content generation timed out. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Error polling for content:', error);
                        if (attempts >= maxAttempts) {
                            clearInterval(poll);
                            showError('Failed to fetch generated content');
                        }
                    });
            }, 5000); // Poll every 5 seconds
        }

        function showError(message) {
            const container = document.getElementById('generatedContent');
            container.innerHTML = `
                <div class="alert alert-danger" role="alert">
                    <i class="fas fa-exclamation-circle"></i> ${message}
                </div>
            `;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-check-circle me-2"></i>
                    ${message}
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Custom Format Functions
        const formatTemplates = {
            listicle: "ðŸ“ {number}. **{point_title}**\n{description}\n\n{key_takeaway}",
            howto: "ðŸ”§ **How to {achieve_goal}**\n\nStep 1: {step_1}\nStep 2: {step_2}\nStep 3: {step_3}\n\nðŸ’¡ Pro Tip: {pro_tip}",
            question: "â“ **{question}**\n\n{answer}\n\nðŸŽ¯ Key Insight: {insight}\n\n{call_to_action}",
            story: "ðŸ“– **Story: {title}**\n\n{opening}\n\n{challenge}\n\n{solution}\n\n{lesson_learned}\n\n{hashtag}",
            comparison: "âš–ï¸ **{option_1} vs {option_2}**\n\nâœ… {option_1}:\n{pros_1}\n\nâŒ {option_2}:\n{pros_2}\n\nðŸ† Winner: {winner}\n\n{reasoning}",
            announcement: "ðŸ“¢ **Big News!** ðŸŽ‰\n\n{announcement}\n\nðŸŽ¯ What this means: {impact}\n\nðŸ“… When: {timeline}\n\n{call_to_action}",
            tutorial: "ðŸ“š **Tutorial: {topic}**\n\nðŸŽ¯ Objective: {objective}\n\nðŸ“‹ Materials needed:\n{materials}\n\nðŸ”§ Step-by-step:\n{steps}\n\nâœ… Result: {expected_result}",
            case_study: "ðŸ“Š **Case Study: {company}**\n\nðŸŽ¯ Challenge: {challenge}\n\nðŸ’¡ Solution: {solution}\n\nðŸ“ˆ Results: {results}\n\nðŸ”‘ Key Learning: {key_learning}"
        };

        const quickTemplates = {
            hook_problem_solution: "ðŸŽ£ **{hook}**\n\nðŸ’¡ The Problem:\n{problem_description}\n\nâœ… Our Solution:\n{solution_description}\n\nðŸš€ Result:\n{outcome}\n\n{hashtags}",
            tip_stat_cta: "ðŸ’¡ **Quick Tip:** {tip}\n\nðŸ“Š Did you know?\n{statistic}\n\nðŸ‘‰ {call_to_action}\n\n{hashtags}",
            question_answer_insight: "â“ **{engaging_question}**\n\nðŸŽ¯ Here's what you need to know:\n{answer}\n\nðŸ’¡ Key Insight:\n{insight}\n\n{call_to_action}\n\n{hashtags}"
        };

        function updateFormatTemplate() {
            const formatType = document.getElementById('formatType');
            if (!formatType) return;

            const customInput = document.getElementById('customFormatInput');
            const preview = document.getElementById('formatPreview');
            const customTemplateTextarea = document.getElementById('customFormatTemplate');

            if (formatType.value === 'custom') {
                // Show custom input, hide preview
                if (customInput) customInput.style.display = 'block';
                if (preview) preview.style.display = 'none';
            } else if (formatType.value && formatTemplates && formatTemplates[formatType.value]) {
                // Show preview, hide custom input
                if (customInput) customInput.style.display = 'none';
                if (preview) preview.style.display = 'block';
                const previewText = document.getElementById('formatPreviewText');
                if (previewText) previewText.textContent = formatTemplates[formatType.value];

                // Clear custom template textarea
                if (customTemplateTextarea) customTemplateTextarea.value = '';
            } else {
                // Hide both
                if (customInput) customInput.style.display = 'none';
                if (preview) preview.style.display = 'none';
            }
        }

        function applyQuickTemplate(templateName) {
            const template = quickTemplates[templateName];
            const formatType = document.getElementById('formatType');
            const customInput = document.getElementById('customFormatInput');
            const customTemplateTextarea = document.getElementById('customFormatTemplate');

            if (template && formatType && customInput && customTemplateTextarea) {
                formatType.value = 'custom';
                customInput.style.display = 'block';
                customTemplateTextarea.value = template;

                // Hide preview since we're in custom mode
                const preview = document.getElementById('formatPreview');
                if (preview) preview.style.display = 'none';

                showNotification(`Applied ${templateName.replace(/_/g, ' ')} template`, 'success');
            }
        }

        // Structured Topic Builder Functions
        let keyPointsList = [];

        function addKeyPoint() {
            const input = document.querySelector('#keyPointsContainer input');
            const keyPoint = input.value.trim();

            if (keyPoint) {
                keyPointsList.push(keyPoint);
                updateKeyPointsDisplay();
                input.value = '';
                showNotification('Key point added', 'success');
            }
        }

        function removeKeyPoint(index) {
            keyPointsList.splice(index, 1);
            updateKeyPointsDisplay();
        }

        function updateKeyPointsDisplay() {
            const container = document.getElementById('keyPointsList');

            if (keyPointsList.length === 0) {
                container.innerHTML = '<p class="text-muted">No key points added yet</p>';
            } else {
                container.innerHTML = keyPointsList.map((point, index) => `
                    <div class="d-flex align-items-center justify-content-between bg-light p-2 rounded mb-2">
                        <span>${point}</span>
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeKeyPoint(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `).join('');
            }
        }

        function generateStructuredTopic() {
            const mainTopic = document.getElementById('mainTopic').value.trim();
            const targetAudience = document.getElementById('targetAudience').value;
            const contentGoal = document.getElementById('contentGoal').value;
            const toneOfVoice = document.getElementById('toneOfVoice').value;
            const callToAction = document.getElementById('callToAction').value.trim();

            if (!mainTopic) {
                showNotification('Please enter a main topic', 'error');
                return;
            }

            // Build structured topic description
            let topicDescription = `Topic: ${mainTopic}`;

            if (targetAudience) {
                const audienceMap = {
                    'general': 'General Public',
                    'professionals': 'Industry Professionals',
                    'experts': 'Subject Matter Experts',
                    'beginners': 'Beginners/Newcomers',
                    'executives': 'Business Executives'
                };
                topicDescription += ` | Target: ${audienceMap[targetAudience] || targetAudience}`;
            }

            if (contentGoal) {
                const goalMap = {
                    'educate': 'Educational Content',
                    'entertain': 'Entertaining Content',
                    'inspire': 'Inspirational Content',
                    'persuade': 'Persuasive Content',
                    'inform': 'Informational Content'
                };
                topicDescription += ` | Goal: ${goalMap[contentGoal] || contentGoal}`;
            }

            if (toneOfVoice) {
                topicDescription += ` | Tone: ${toneOfVoice.charAt(0).toUpperCase() + toneOfVoice.slice(1)}`;
            }

            if (keyPointsList.length > 0) {
                topicDescription += ` | Key Points: ${keyPointsList.join(', ')}`;
            }

            if (callToAction) {
                topicDescription += ` | CTA: ${callToAction}`;
            }

            // Add this to the custom topics list
            const customTopicInput = document.getElementById('customTopicInput');
            if (customTopicInput) {
                customTopicInput.value = topicDescription;
                addCustomTopic();
            }

            // Clear the form
            document.getElementById('mainTopic').value = '';
            document.getElementById('targetAudience').value = '';
            document.getElementById('contentGoal').value = '';
            document.getElementById('toneOfVoice').value = '';
            document.getElementById('callToAction').value = '';
            keyPointsList = [];
            updateKeyPointsDisplay();

            showNotification('Structured topic generated and added!', 'success');

            // Close the accordion
            const collapse = document.getElementById('topicBuilderCollapse');
            const bsCollapse = bootstrap.Collapse.getInstance(collapse);
            if (bsCollapse) {
                bsCollapse.hide();
            }
        }

        // Enhanced Content Generation Functions
        let examplePosts = [];

        function toggleGenerationMethod() {
            const method = document.querySelector('input[name="generationMethod"]:checked').value;
            const instructionsSection = document.getElementById('instructionsSection');
            const examplesSection = document.getElementById('examplesSection');

            if (method === 'instructions') {
                instructionsSection.style.display = 'block';
                examplesSection.style.display = 'none';
            } else {
                instructionsSection.style.display = 'none';
                examplesSection.style.display = 'block';
            }
        }

        function addInstructionTemplate() {
            const templateSelect = document.getElementById('instructionTemplate');
            if (templateSelect.style.display === 'none') {
                templateSelect.style.display = 'block';
            } else {
                templateSelect.style.display = 'none';
            }
        }

        function applyInstructionTemplate() {
            const templateType = document.getElementById('instructionTemplate').value;
            const instructionsField = document.getElementById('customInstructions');

            const templates = {
                professional: `Write in a professional, authoritative tone suitable for business executives and industry experts.

Requirements:
- Use industry-specific terminology appropriately
- Include relevant statistics, research findings, or data
- Maintain a formal but engaging style
- Focus on actionable insights and strategic implications
- Use clear, structured paragraphs with logical flow
- Include 2-3 relevant hashtags at the end

Example approach: Start with a compelling insight, support with evidence, and conclude with actionable takeaways.`,

                casual: `Write in a casual, conversational tone like you're talking to a friend over coffee.

Requirements:
- Use simple, everyday language and avoid jargon
- Include relatable examples and personal anecdotes
- Use humor and wit where appropriate
- Write in short, easy-to-read sentences
- Use emojis occasionally (1-2 per post)
- Include friendly, engaging hashtags

Example approach: Start with a relatable problem, share personal experience, and end with an encouraging thought.`,

                educational: `Write in an educational, informative style that teaches valuable concepts clearly.

Requirements:
- Break down complex topics into simple, digestible parts
- Use analogies and metaphors to explain difficult concepts
- Include practical examples and real-world applications
- Structure content with clear headings or bullet points
- Encourage learning and curiosity
- Include educational hashtags

Example approach: Introduction â†’ Main concept explanation â†’ Practical examples â†’ Key takeaways â†’ Call to action for further learning.`,

                storytelling: `Write using storytelling techniques to make content engaging and memorable.

Requirements:
- Begin with a compelling hook or story
- Use narrative structure (setup, conflict, resolution)
- Include emotional elements and personal connections
- Use vivid descriptions and sensory details
- End with a meaningful lesson or insight
- Include storytelling-related hashtags

Example approach: Hook â†’ Personal story â†’ Lesson learned â†’ Broader application â†’ Call to action.`,

                data_driven: `Write in an analytical, data-driven style that emphasizes facts and insights.

Requirements:
- Include specific statistics, percentages, or research findings
- Cite credible sources or studies when possible
- Focus on logical reasoning and evidence-based conclusions
- Use charts or data visualizations in descriptions
- Provide actionable insights based on data
- Include data and analytics hashtags

Example approach: Key finding â†’ Supporting data â†’ Analysis â†’ Implications â†’ Recommendations.`
            };

            if (templates[templateType]) {
                instructionsField.value = templates[templateType];
                showNotification(`Applied ${templateType.replace('_', ' ')} template`, 'success');
            }
        }

        function addExample() {
            const topic = document.getElementById('exampleTopic').value.trim();
            const content = document.getElementById('exampleContent').value.trim();
            const hashtags = document.getElementById('exampleHashtags').value.trim();

            if (!topic || !content) {
                showNotification('Please fill in both topic and content', 'error');
                return;
            }

            const example = {
                id: Date.now(),
                topic,
                content,
                hashtags
            };

            examplePosts.push(example);
            updateExamplesDisplay();

            // Clear form
            document.getElementById('exampleTopic').value = '';
            document.getElementById('exampleContent').value = '';
            document.getElementById('exampleHashtags').value = '';

            showNotification('Example added successfully!', 'success');
        }

        function removeExample(id) {
            examplePosts = examplePosts.filter(ex => ex.id !== id);
            updateExamplesDisplay();
            showNotification('Example removed', 'info');
        }

        function updateExamplesDisplay() {
            const container = document.getElementById('examplesList');

            if (examplePosts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-muted">
                        <i class="fas fa-inbox fa-2x mb-2"></i>
                        <p>No examples added yet</p>
                        <small>Add examples to teach the AI your preferred writing style</small>
                    </div>
                `;
            } else {
                container.innerHTML = examplePosts.map((example, index) => `
                    <div class="card border-secondary mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="card-subtitle mb-0">${example.topic}</h6>
                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeExample(${example.id})">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="content-preview small mb-2" style="max-height: 100px; overflow-y: auto;">
                                ${example.content.substring(0, 200)}${example.content.length > 200 ? '...' : ''}
                            </div>
                            ${example.hashtags ? `<small class="text-muted">${example.hashtags}</small>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        async function loadExistingExamples() {
            try {
                // Load posts from generated posts endpoint
                const platforms = ['linkedin', 'twitter', 'instagram'];
                let allPosts = [];

                for (const platform of platforms) {
                    try {
                        const response = await fetch(`/api/generated-posts/${platform}`);
                        const data = await response.json();
                        if (data.success && data.posts) {
                            const platformPosts = data.posts
                                .filter(post => post.content && post.content.trim() !== '')
                                .slice(0, 3) // Take first 3 posts per platform
                                .map(post => ({
                                    id: Date.now() + Math.random(),
                                    topic: post.topic || post.title || 'Example Post',
                                    content: post.content,
                                    hashtags: post.hashtags || ''
                                }));
                            allPosts = allPosts.concat(platformPosts);
                        }
                    } catch (err) {
                        console.log(`Could not load ${platform} posts:`, err);
                    }
                }

                if (allPosts.length > 0) {
                    examplePosts = examplePosts.concat(allPosts.slice(0, 5)); // Add max 5 examples
                    updateExamplesDisplay();
                    showNotification(`Loaded ${allPosts.slice(0, 5).length} example posts`, 'success');
                } else {
                    showNotification('No existing posts found to load as examples', 'info');
                }
            } catch (error) {
                console.error('Error loading examples:', error);
                showNotification('Failed to load existing posts', 'error');
            }
        }

        function getGenerationSettings() {
            const method = document.querySelector('input[name="generationMethod"]:checked').value;
            const creativity = document.getElementById('creativityLevel').value;
            const contentLength = document.getElementById('contentLength').value;
            const focusEngagement = document.getElementById('focusEngagement').checked;
            const focusSEO = document.getElementById('focusSEO').checked;
            const focusTrending = document.getElementById('focusTrending').checked;

            const settings = {
                method,
                creativity,
                contentLength,
                focusAreas: {
                    engagement: focusEngagement,
                    seo: focusSEO,
                    trending: focusTrending
                }
            };

            if (method === 'instructions') {
                settings.instructions = document.getElementById('customInstructions').value;
            } else {
                settings.examples = examplePosts;
            }

            return settings;
        }

        // Modern Navigation System
        function initializeModernNavigation() {
            // Navigation item clicks
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = item.dataset.section;
                    switchSection(section);
                });
            });

            // Initialize first section
            switchSection('basic');
        }

        function switchSection(sectionName) {
            // Update navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === sectionName) {
                    item.classList.add('active');
                }
            });

            // Update content sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            const targetSection = document.getElementById(`${sectionName}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Update progress steps
            updateProgressSteps(sectionName);
        }

        function updateProgressSteps(sectionName) {
            const stepMap = {
                'basic': 1,
                'advanced': 1,
                'formats': 1,
                'topics': 1
            };

            const stepNumber = stepMap[sectionName] || 1;
            const steps = document.querySelectorAll('.step');

            steps.forEach((step, index) => {
                if (index < stepNumber) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }

        // Update content counter
        function updateContentCount() {
            const count = document.querySelectorAll('#generatedContent .generated-content-item').length;
            const countElement = document.getElementById('contentCount');
            if (countElement) {
                countElement.textContent = count;
            }
        }

        // Display generated content in sidebar
        function displayGeneratedContent(posts) {
            const container = document.getElementById('generatedContent');
            if (!container) return;

            if (!posts || posts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-sparkles"></i>
                        <h3>Ready to Generate</h3>
                        <p>Configure settings and click Generate</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = posts.map((post, index) => {
                const platform = post.platform || 'linkedin';
                const platformIcon = platform === 'linkedin' ? 'fab fa-linkedin' :
                                   platform === 'twitter' ? 'fab fa-x-twitter' :
                                   'fab fa-instagram';
                const platformColor = platform === 'linkedin' ? '#0077b5' :
                                     platform === 'twitter' ? '#000000' :
                                     '#E4405F';

                return `
                    <div class="generated-content-item">
                        <div class="content-item-header">
                            <div class="content-item-platform">
                                <i class="${platformIcon}" style="color: ${platformColor}"></i>
                                ${platform.charAt(0).toUpperCase() + platform.slice(1)}
                            </div>
                            <div class="content-item-actions">
                                <button class="btn btn-sm btn-outline-primary" onclick="copyContent(${index})" title="Copy">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="editContent(${index})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                        <div class="content-item-content">
                            ${post.content || 'Generated content...'}
                        </div>
                        ${post.hashtags ? `
                            <div class="content-item-hashtags">
                                ${post.hashtags}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            updateContentCount();
        }

        // Copy content function
        function copyContent(index) {
            // Implementation for copying content
            showNotification('Content copied to clipboard!', 'success');
        }

        // Edit content function
        function editContent(index) {
            // Implementation for editing content
            showNotification('Edit feature coming soon!', 'info');
        }

        // Modern Form Interactions
        function initializeModernFormElements() {
            // Platform selection
            const platformItems = document.querySelectorAll('.platform-item');
            platformItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    if (e.target.tagName !== 'INPUT') {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                        this.classList.toggle('selected', checkbox.checked);
                    }
                });

                // Initialize selected state
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox && checkbox.checked) {
                    item.classList.add('selected');
                }
            });

            // Style selection cards
            const styleCards = document.querySelectorAll('.style-option-card');
            styleCards.forEach(card => {
                card.addEventListener('click', function(e) {
                    if (e.target.tagName !== 'INPUT') {
                        const radio = this.querySelector('input[type="radio"]');
                        radio.checked = true;

                        // Remove selected from all cards
                        styleCards.forEach(c => c.classList.remove('selected'));
                        // Add selected to clicked card
                        this.classList.add('selected');
                    }
                });

                // Initialize selected state
                const radio = card.querySelector('input[type="radio"]');
                if (radio && radio.checked) {
                    card.classList.add('selected');
                }
            });

            // Platform checkbox change events
            const platformCheckboxes = document.querySelectorAll('.platform-item input[type="checkbox"]');
            platformCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const item = this.closest('.platform-item');
                    item.classList.toggle('selected', this.checked);
                });
            });

            // Style radio change events
            const styleRadios = document.querySelectorAll('.style-option-card input[type="radio"]');
            styleRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    styleCards.forEach(card => card.classList.remove('selected'));
                    const selectedCard = this.closest('.style-option-card');
                    if (this.checked) {
                        selectedCard.classList.add('selected');
                    }
                });
            });
        }

        // Theme Toggle Functionality
        function initializeThemeToggle() {
            // Create theme toggle button
            const themeToggle = document.createElement('button');
            themeToggle.className = 'theme-toggle';
            themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            themeToggle.onclick = toggleTheme;

            // Add to header
            const headerActions = document.querySelector('.header-actions');
            if (headerActions) {
                headerActions.appendChild(themeToggle);
            }

            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
        }

        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            const themeIcon = document.getElementById('themeIcon');

            if (body.classList.contains('dark-theme')) {
                body.classList.remove('dark-theme');
                if (themeToggle) themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                if (themeIcon) themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-theme');
                if (themeToggle) themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                if (themeIcon) themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Method selection functions
        function selectMethod(method, element) {
            // Update UI
            document.querySelectorAll('.method-option').forEach(option => {
                option.classList.remove('active');
            });
            element.classList.add('active');

            // Show/hide sections
            const instructionsSection = document.getElementById('instructionsSection');
            const examplesSection = document.getElementById('examplesSection');

            if (method === 'instructions') {
                instructionsSection.style.display = 'block';
                examplesSection.style.display = 'none';
            } else {
                instructionsSection.style.display = 'none';
                examplesSection.style.display = 'block';
            }
        }

        function toggleInstructionTemplates() {
            const templateSelect = document.getElementById('instructionTemplate');
            if (templateSelect.style.display === 'none') {
                templateSelect.style.display = 'block';
            } else {
                templateSelect.style.display = 'none';
            }
        }

        // Simplified theme toggle initialization
        function initializeThemeToggle() {
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            const themeIcon = document.getElementById('themeIcon');

            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                if (themeIcon) themeIcon.className = 'fas fa-sun';
            }
        }

        // Add theme toggle styles
        const themeStyles = `
            .theme-toggle {
                background: var(--darker-color);
                border: 1px solid var(--card-border);
                color: var(--text-primary);
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-left: 1rem;
            }

            .theme-toggle:hover {
                background: var(--primary-color);
                color: white;
                transform: scale(1.1);
            }

            .dark-theme {
                --card-bg: #1a1a2e;
                --darker-color: #16213e;
                --card-border: #2d3561;
                --text-primary: #e8e8e8;
                --text-muted: #a8a8a8;
                --primary-color: #667eea;
            }

            /* Simple Layout CSS */
            .simple-header {
                background: var(--card-bg);
                padding: 2rem 2rem 1rem;
                margin: -2rem -2rem 2rem -2rem;
                border-bottom: 1px solid var(--card-border);
            }

            .header-top {
                display: flex;
                justify-content: space-between;
                align-items: center;
                max-width: 100%;
            }

            .header-title h1 {
                font-size: 2rem;
                font-weight: 700;
                color: var(--text-primary);
                margin-bottom: 0.25rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .header-title p {
                color: var(--text-muted);
                margin: 0;
            }

            .content-wrapper {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 2rem;
            }

            .main-content-area {
                background: var(--card-bg);
                border-radius: var(--border-radius-modern);
                padding: 2rem;
                box-shadow: var(--shadow-modern);
            }

            .settings-section {
                margin-bottom: 3rem;
            }

            .section-title {
                text-align: center;
                margin-bottom: 2rem;
            }

            .section-title h2 {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--text-primary);
                margin-bottom: 0.5rem;
            }

            .section-title p {
                color: var(--text-muted);
                margin: 0;
            }

            .settings-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            @media (min-width: 992px) {
                .settings-grid {
                    grid-template-columns: 1fr 1fr;
                }
            }

            .setting-card h3 {
                font-size: 1.25rem;
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 1.5rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .method-selection {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
                margin-top: 0.5rem;
            }

            .method-option {
                padding: 1rem;
                background: var(--darker-color);
                border: 2px solid var(--card-border);
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: left;
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .method-option:hover {
                border-color: var(--primary-color);
                background: rgba(102, 126, 234, 0.05);
            }

            .method-option.active {
                border-color: var(--primary-color);
                background: rgba(102, 126, 234, 0.1);
            }

            .method-option i {
                font-size: 1.5rem;
                color: var(--primary-color);
                width: 30px;
                text-align: center;
            }

            .method-option strong {
                color: var(--text-primary);
                font-size: 1rem;
                display: block;
                margin-bottom: 0.25rem;
            }

            .method-option p {
                color: var(--text-muted);
                font-size: 0.875rem;
                margin: 0;
            }

            .method-section {
                margin-top: 1.5rem;
            }

            .quick-templates {
                display: flex;
                gap: 0.5rem;
                align-items: center;
                margin-top: 0.5rem;
            }

            .example-input {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .settings-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }

            .generate-section {
                text-align: center;
                margin: 3rem 0;
            }

            .generate-btn {
                background: var(--primary-gradient);
                color: white;
                border: none;
                padding: 1rem 3rem;
                border-radius: 50px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                display: inline-flex;
                align-items: center;
                gap: 0.75rem;
            }

            .generate-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            }

            .generated-section {
                margin-top: 3rem;
                padding: 2rem;
                background: var(--darker-color);
                border-radius: var(--border-radius-modern);
                min-height: 200px;
            }

            .empty-state {
                text-align: center;
                color: var(--text-muted);
            }

            .empty-state i {
                font-size: 3rem;
                margin-bottom: 1rem;
                color: var(--primary-color);
            }

            .empty-state h3 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
                color: var(--text-primary);
            }

            .examples-list {
                margin-top: 1rem;
                max-height: 200px;
                overflow-y: auto;
            }

            /* Comprehensive Responsive Design */

/* Mobile First (320px - 767px) */
@media (max-width: 767px) {
    .simple-header {
                padding: 1rem;
                margin: -1rem -1rem 1rem -1rem;
            }

            .header-top {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
                text-align: center;
            }

            .header-title h1 {
                font-size: 1.5rem;
                justify-content: center;
            }

            .content-wrapper {
                padding: 0 0.5rem;
            }

            .main-content-area {
                padding: 1rem;
                border-radius: 12px;
            }

            .settings-section {
                margin-bottom: 2rem;
            }

            .section-title {
                margin-bottom: 1.5rem;
            }

            .section-title h2 {
                font-size: 1.25rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .setting-card {
                padding: 1.5rem;
                border-radius: 12px;
            }

            .setting-card h3 {
                font-size: 1.1rem;
                margin-bottom: 1rem;
            }

            .form-group-modern {
                margin-bottom: 1.25rem;
            }

            .form-label-modern {
                font-size: 0.85rem;
                margin-bottom: 0.5rem;
            }

            .form-control-modern,
            .form-select-modern {
                padding: 0.6rem 0.75rem;
                font-size: 0.9rem;
            }

            .style-options-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .style-option-card {
                padding: 0.75rem;
            }

            .platform-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .platform-item {
                padding: 0.5rem;
            }

            .method-selection {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .method-option {
                padding: 0.75rem;
                gap: 0.75rem;
            }

            .method-option i {
                font-size: 1.25rem;
                width: 25px;
            }

            .method-option strong {
                font-size: 0.9rem;
            }

            .method-option p {
                font-size: 0.8rem;
            }

            .settings-row {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .quick-templates {
                flex-direction: column;
                align-items: stretch;
            }

            .generate-section {
                margin: 2rem 0;
            }

            .generate-btn {
                padding: 0.875rem 2rem;
                font-size: 1rem;
                width: 100%;
                max-width: 300px;
            }

            .generated-section {
                padding: 1.5rem;
                margin-top: 2rem;
            }

            .empty-state i {
                font-size: 2rem;
            }

            .empty-state h3 {
                font-size: 1.25rem;
            }

            .voice-input-card {
                padding: 1rem;
            }

            .voice-button {
                width: 60px;
                height: 60px;
                font-size: 1.25rem;
            }

            /* Touch-friendly improvements */
            .btn, .platform-item, .style-option-card, .method-option {
                min-height: 44px;
            }

            /* Better spacing for touch */
            .form-group-modern {
                margin-bottom: 1.5rem;
            }

            /* Reduce cognitive load */
            .method-section {
                margin-top: 1rem;
            }

            /* Simplified navigation */
            .theme-toggle {
                width: 44px;
                height: 44px;
            }
        }

        /* Tablet (768px - 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .content-wrapper {
                padding: 0 1.5rem;
            }

            .main-content-area {
                padding: 1.5rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
                gap: 1.75rem;
            }

            .style-options-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .platform-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .method-selection {
                grid-template-columns: 1fr 1fr;
            }

            .settings-row {
                grid-template-columns: 1fr 1fr;
            }

            .generate-btn {
                padding: 0.9375rem 2.5rem;
                font-size: 1.05rem;
            }

            /* Tablet-specific improvements */
            .header-title h1 {
                font-size: 1.75rem;
            }

            .setting-card {
                padding: 1.75rem;
            }

            .voice-input-card {
                padding: 1.25rem;
            }

            .voice-button {
                width: 70px;
                height: 70px;
                font-size: 1.375rem;
            }
        }

        /* Desktop (1024px+) */
        @media (min-width: 1024px) {
            .content-wrapper {
                padding: 0 2rem;
            }

            .main-content-area {
                padding: 2rem;
            }

            .settings-grid {
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }

            .style-options-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }

            .platform-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }

            .method-selection {
                grid-template-columns: 1fr 1fr;
            }

            .settings-row {
                grid-template-columns: 1fr 1fr;
            }

            /* Desktop enhancements */
            .setting-card {
                padding: 2rem;
            }

            .setting-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            }

            .generate-btn {
                padding: 1rem 3rem;
                font-size: 1.1rem;
            }

            .voice-button {
                width: 80px;
                height: 80px;
                font-size: 1.5rem;
            }

            /* Large Desktop (1440px+) */
            @media (min-width: 1440px) {
                .content-wrapper {
                    max-width: 1400px;
                }

                .settings-grid {
                    gap: 2.5rem;
                }

                .main-content-area {
                    padding: 2.5rem;
                }
            }

            /* Ultra-wide (1920px+) */
            @media (min-width: 1920px) {
                .content-wrapper {
                    max-width: 1600px;
                }

                .settings-grid {
                    grid-template-columns: repeat(3, 1fr);
                }

                .main-layout {
                    gap: 2.5rem;
                }

                .generated-content-sidebar {
                    width: 450px;
                }
            }

            /* Two-Column Layout CSS */
            .main-layout {
                display: flex;
                gap: 2rem;
                align-items: flex-start;
            }

            .settings-column {
                flex: 1;
                min-width: 0;
            }

            .generated-content-sidebar {
                width: 380px;
                background: var(--card-bg);
                border-radius: var(--border-radius-modern);
                box-shadow: var(--shadow-modern);
                position: sticky;
                top: 2rem;
                max-height: calc(100vh - 4rem);
                overflow-y: auto;
                display: flex;
                flex-direction: column;
            }

            .sidebar-header {
                padding: 1.5rem;
                border-bottom: 1px solid var(--card-border);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .sidebar-header h3 {
                font-size: 1.125rem;
                font-weight: 600;
                color: var(--text-primary);
                margin: 0;
            }

            .content-stats {
                background: var(--darker-color);
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-size: 0.875rem;
                color: var(--text-muted);
            }

            .content-stats span {
                font-weight: 600;
                color: var(--primary-color);
            }

            .generated-content {
                flex: 1;
                padding: 1.5rem;
                overflow-y: auto;
            }

            .floating-generate-btn {
                display: none;
                position: fixed;
                bottom: 2rem;
                right: 2rem;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: var(--primary-gradient);
                border: none;
                color: white;
                font-size: 1.25rem;
                cursor: pointer;
                box-shadow: var(--shadow-hover);
                z-index: 1000;
                transition: all 0.3s ease;
            }

            .floating-generate-btn:hover {
                transform: scale(1.1);
                box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            }

            /* Responsive adjustments for two-column layout */
            @media (max-width: 1200px) {
                .main-layout {
                    flex-direction: column;
                }

                .generated-content-sidebar {
                    width: 100%;
                    position: static;
                    max-height: none;
                    margin-top: 2rem;
                }

                .floating-generate-btn {
                    display: block;
                }

                .generate-section {
                    display: none;
                }
            }

            @media (max-width: 767px) {
                .main-layout {
                    gap: 1rem;
                }

                .generated-content-sidebar {
                    margin-top: 1rem;
                }

                .sidebar-header {
                    padding: 1rem;
                }

                .sidebar-header h3 {
                    font-size: 1rem;
                }

                .generated-content {
                    padding: 1rem;
                }

                .floating-generate-btn {
                    width: 56px;
                    height: 56px;
                    font-size: 1.125rem;
                    bottom: 1rem;
                    right: 1rem;
                }
            }

            /* Content preview styling */
            .generated-content-item {
                background: var(--darker-color);
                border-radius: 12px;
                padding: 1.25rem;
                margin-bottom: 1rem;
                border-left: 4px solid var(--primary-color);
                transition: all 0.3s ease;
            }

            .generated-content-item:hover {
                transform: translateX(-5px);
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }

            .content-item-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.75rem;
            }

            .content-item-platform {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.25rem 0.75rem;
                background: var(--card-bg);
                border-radius: 15px;
                font-size: 0.75rem;
                font-weight: 500;
            }

            .content-item-actions {
                display: flex;
                gap: 0.5rem;
            }

            .content-item-actions button {
                padding: 0.25rem 0.5rem;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .content-item-content {
                color: var(--text-primary);
                line-height: 1.5;
                margin-bottom: 0.75rem;
                font-size: 0.9rem;
            }

            .content-item-hashtags {
                color: var(--primary-color);
                font-size: 0.8rem;
            }

            /* Loading state */
            .loading-state {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 2rem;
                color: var(--text-muted);
            }

            .loading-spinner {
                width: 40px;
                height: 40px;
                border: 3px solid var(--card-border);
                border-top: 3px solid var(--primary-color);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-bottom: 1rem;
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        }
        `;

        // Add theme styles to head
        const styleSheet = document.createElement('style');
        styleSheet.textContent = themeStyles;
        document.head.appendChild(styleSheet);

        // Initialize format template on load
        function initializeFormatTemplate() {
            const formatType = document.getElementById('formatType');
            const customInput = document.getElementById('customFormatInput');
            const preview = document.getElementById('formatPreview');

            // Hide both initially
            if (customInput) customInput.style.display = 'none';
            if (preview) preview.style.display = 'none';
        }

        // Initialize simple interface
        document.addEventListener('DOMContentLoaded', () => {
            initializeModernFormElements();
            initializeThemeToggle();

            // Update content counter
            updateContentCount();

            // Initialize examples display if function exists
            if (typeof updateExamplesDisplay === 'function') {
                updateExamplesDisplay();
                examplePosts = []; // Reset example posts
            }
        });
    </script>
{% endblock %}